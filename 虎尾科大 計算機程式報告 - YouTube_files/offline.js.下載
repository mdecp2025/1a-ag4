(function(g){var window=this;'use strict';var Raj=function(w){const Q=new g.F0("und",new g.P0("Default","und",!0));Q.captionTracks=w.captionTracks;return Q},O7L=function(w){return new g.cB(function(Q,G){let J=w.length;
const N=[];if(J){var C=function(L,v){J--;N[L]=v;J==0&&Q(N)},W=function(L){G(L)};
for(let L=0;L<w.length;L++){var t=w[L];g.HB(t,g.wd(C,L),W)}}else Q(N)})},lfJ=function({type:w,
payload:Q}){w={type:w};Q!==void 0&&(w.payload=Q);return w},FZ=function(w){w=w.key||w.id;
if(!w)throw Error("Entity key is missing");return w},Kxo=function(){if(Sj)return Sj();
Sj=g.AQ("PersistentEntityStoreDb",{Tg:{EntityStore:{ez:1},EntityAssociationStore:{ez:2}},shared:!1,upgrade(w,Q){Q(1)&&g.Gw(g.ut(w,"EntityStore",{keyPath:"key"}),"entityType","entityType");Q(2)&&(w=g.ut(w,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Gw(w,"byParentEntityKey","parentEntityKey"),g.Gw(w,"byChildEntityKey","childEntityKey"))},version:3});return Sj()},P6j=function(w){return g.Li(Kxo(),w)},XZ=function(w){return g.Li((0,g.u6G)(),w)},gpl=function(w){return w instanceof
Error?new bE("UNKNOWN_ENCODE_ERROR",{originalMessage:w.message}):new bE("UNKNOWN_ENCODE_ERROR")},eao=function(w){return w instanceof Error?new bE("UNKNOWN_DECODE_ERROR",{originalMessage:w.message}):new bE("UNKNOWN_DECODE_ERROR")},H73=function(w,Q){w=w instanceof bE?w:Q(w);
g.P(w);throw w;},hal=function(w,Q,G){try{return w.A(Q,G)}catch(J){H73(J,gpl)}},x3=function(w){w=(new TextEncoder).encode(w).subarray(0,16);
const Q=new Uint8Array(16);Q.set(w);return Q},Ep4=function(w){const Q=jDJ[w];
if(Q)return Q;g.Ou(new g.Gu("Entity model not found.",{entityType:w}))},VD=function(w,Q){a:{w=Un(w.W,Q.version);
try{var G=w.W(Q.data,Q.key);break a}catch(J){H73(J,eao)}G=void 0}return G},Zk=function(w,Q,G){return w.Y.objectStore("EntityStore").get(Q).then(J=>{if(J){if(G&&J.entityType!==G)throw Error("Incorrect entity type");
return VD(w,J)}})},k3=function(w,Q,G){return G?(G=G.map(J=>Zk(w,J,Q)),g.eJ.all(G)):w.Y.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(Q)).then(J=>J.map(N=>VD(w,N)))},pP3=function(w,Q,G){const J=FZ(Q);
return rC(w,J).then(()=>TuL(w,Q,G))},yD=function(w,Q,G){let J=w.A[G];
J||(J=new Set,w.A[G]=J);J.add(Q)},Dk=function(w,Q,G){const J=FZ(Q),N=Un(w.W,1),C={...Q};
return w.Y.objectStore("EntityStore").get(J).then(W=>{if(W){if(W.entityType!==G)throw Error("Incorrect entity type");C.entityMetadata||(W=VD(w,W),C.entityMetadata=W.entityMetadata)}}).then(()=>{const W={key:J,
entityType:G,data:hal(N,C,J),version:1};return g.eJ.all([g.iT(w.Y.objectStore("EntityStore"),W),pP3(w,C,G)])}).then(()=>{yD(w,J,G);
return J})},aU=function(w,Q,G){Q=Q.map(J=>Dk(w,J,G));
return g.eJ.all(Q)},wg4=function(w,Q,G){if(G.has(Q))return g.eJ.resolve(void 0);
G.add(Q);return uyb(w,Q).then(J=>w.Y.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(Q)).then(()=>J)).then(J=>{let N=g.eJ.resolve(void 0);
for(const C of J)N=N.then(()=>wg4(w,C,G));
return N}).then(()=>{})},Y3=function(w,Q,G){if(G?.cV){const N=new Set;
return wg4(w,Q,N).then(()=>{const C=[];for(const W of N)C.push(Y3(w,W));return g.eJ.all(C).then(()=>{})})}const J=g.GJ(Q).entityType;
return g.eJ.all([w.Y.objectStore("EntityStore").delete(Q),rC(w,Q)]).then(()=>{yD(w,Q,J)})},rC=function(w,Q){return w.Y.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(Q))},nA=function(w,Q){return g.Wa(w.Y.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(Q)},G=>g.eJ.all([G.delete(),
rC(w,G.cursor.primaryKey)]).then(()=>{yD(w,G.cursor.primaryKey,Q);return g.Ci(G)}))},i5R=function(w,Q,G,J){const N=Un(w.W,1);
return Zk(w,Q,J).then(C=>{if(C){C=g.SF(C,G);var W={key:Q,entityType:J,data:hal(N,C,Q),version:1};return g.eJ.all([g.iT(w.Y.objectStore("EntityStore"),W),pP3(w,C,J)])}}).then(()=>{yD(w,Q,J);
return Q})},TuL=function(w,Q,G){const J=FZ(Q);
G=Ep4(G);if(!G)return g.eJ.resolve([]);Q=new G(Q);w=w.Y.objectStore("EntityAssociationStore");G=[];for(const N of Q.W())G.push(g.iT(w,{parentEntityKey:J,childEntityKey:N}));return g.eJ.all(G).then(N=>N.map(C=>C[1]))},uyb=function(w,Q){const G=w.Y.objectStore("EntityAssociationStore");
return G.index("byParentEntityKey").getAll(IDBKeyRange.only(Q)).then(J=>{const N=[];for(const C of J)N.push(G.index("byChildEntityKey").getAll(C.childEntityKey));return g.eJ.all(N)}).then(J=>{const N=[];
for(const C of J)C.length===1&&N.push(C[0].childEntityKey);return N})},Un=function(w,Q=0){w=w.Y[Q];
if(!w)throw Q=new bE("INVALID_ENCODER_VERSION",{sY:Q}),g.P(Q),Q;return w},Q90=function(w,Q){for(const G of w.observers)G(Q)},qf=async function(w,Q,G){var J=await P6j(w.token);
let N;Q=await g.p0(J,["EntityStore","EntityAssociationStore"],Q,C=>{N=new Gi4(C,w.Y);return G(N)});
N&&(J=N.A,Object.keys(J).length>0&&(w.channel.postMessage(J),Q90(w,J)));return Q},fA=function(w,Q,G){return qf(w,{mode:"readwrite",
UQ:!0},J=>Dk(J,Q,G))},Jt3=function(w,Q){return qf(w,{mode:"readwrite",
UQ:!0},G=>aU(G,Q,"offlineOrchestrationActionWrapperEntity"))},dC=function(w,Q){return qf(w,{mode:"readwrite",
UQ:!0},G=>Y3(G,Q))},NBR=function(w){return qf(w,{mode:"readwrite",
UQ:!0},Q=>nA(Q,"videoPlaybackPositionEntity"))},zq=function(w,Q,G){return qf(w,{mode:"readonly",
UQ:!0},J=>Zk(J,Q,G))},ci=function(w,Q,G){return qf(w,{mode:"readonly",
UQ:!0},J=>k3(J,Q,G))},tQO=async function(){try{const Q=await g.mK();
if(Q&&g.U4()&&typeof g.cb.BroadcastChannel!=="undefined"){var w=new C4l;return new WoR(Q,w)}}catch(Q){Q instanceof Error&&g.P(Q)}},On=function(){RU||(RU=tQO());
return RU},Loj=function(w){w=w.options?.persistenceOption;
return w==="ENTITY_PERSISTENCE_OPTION_PERSIST"||w==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},vcj=async function(w){const Q=await On();
Q&&await qf(Q,"readwrite",G=>{const J={};for(const N of w){if(!N.entityKey||!Loj(N))continue;const C=g.H2(N.payload);let W=void 0;N.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(W=()=>Dk(G,N.payload[C],C));
N.type==="ENTITY_MUTATION_TYPE_DELETE"&&(W=()=>Y3(G,N.entityKey));
N.type==="ENTITY_MUTATION_TYPE_UPDATE"&&(W=()=>i5R(G,N.entityKey,N.payload[C],C));
W&&(J[N.entityKey]=J[N.entityKey]?J[N.entityKey].then(W):W())}return g.eJ.all(Object.values(J))})},lE=async function(w){!(w=w.mutations)||w.length<=0||(g.GH&&g.GH.dispatch(lfJ({type:"ENTITY_LOADED",
payload:w})),await vcj(w),w.length=0)},s9h=function(w){return w!==void 0},BBk=function(w){var Q=g.di();
Q=Object.assign({},Q);w=Object.assign({},w);for(const G in Q)w[G]?(Q[G]!==4&&(Q[G]=w[G]),delete w[G]):Q[G]!==2&&(Q[G]=4);Object.assign(Q,w);g.zkv(Q);JSON.stringify(Q);return Q},MQl=async function(w){const Q=await g.mK();
return Q?g.p0(await g.RN(Q),["index","media","captions"],{mode:"readwrite",UQ:!0},G=>{const J=IDBKeyRange.bound(w+"|",w+"~");G=[G.objectStore("index").delete(J),G.objectStore("media").delete(J),G.objectStore("captions").delete(J)];return g.eJ.all(G).then(()=>{})}):void 0},IWL=async function(){const w=await g.mK();
if(!w)throw g.ge("rvdfd");return g.p0(await g.RN(w),["index","media"],{mode:"readwrite",UQ:!0},Q=>{const G={};return g.N7(Q.objectStore("index"),{},J=>{var N=J.cursor.key.match(/^([\w\-_]+)\|(a|v)$/);let C=g.eJ.resolve(void 0);if(N){const W=N[1];N=N[2];G[W]=G[W]||{};G[W][N]=g.lIu(J.getValue()?.fmts)}else C=J.delete().then(()=>{});
return g.eJ.all([g.Ci(J),C]).then(([W])=>W)}).then(()=>{const J={};
for(const C of Object.keys(G)){const W=G[C].v;J[C]=G[C].a&&W?1:2}const N=BBk(J);return g.fbA(Q.objectStore("media"),{},C=>{const W=C.cursor.key.match(g.ekq);W&&J[W[1]]||Q.objectStore("media").delete(C.cursor.key);return g.kmV(C)}).then(()=>N)})})},oco=async function(w,Q){var G=await g.mK();
if(!G)throw g.ge("wct");G=await g.RN(G);await g.p0(G,["captions"],{mode:"readwrite",UQ:!0},J=>{const N=[];J=J.objectStore("captions");for(let C=0;C<Q.length;C++){const W=g.iT(J,Q[C],w+"|"+Q[C].metadata.vss_id);N.push(W)}return g.eJ.all(N)})},$3r=async function(w){w=IDBKeyRange.bound(w+"|",w+"~");
const Q=await g.mK();if(!Q)throw g.ge("gactfv");return(await g.RN(Q)).getAll("captions",w)},m3l=async function(w){g.ct(w,0);
return MQl(w)},At4=function(w){return{context:g.II(),
videoIds:w}},For=function(w){return{context:g.II(),
playlistIds:w}},SHb=function(w){return{context:g.II(),
offlinePlaylistSyncChecks:w}},b5k=function(){KA||(KA=new XgR);
return KA},x30=function(w,Q){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:w},metadata:Q,statusCode:void 0,csn:void 0,can:void 0}},U3k=function(w,Q,G){G||(G=w.Y.get("FLOW_TYPE_OFFLINE_ORCHESTRATION"),G||(G=g.Ut(16),w.Y.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",G)));
w={flowNonce:G,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:Q.eventType};Q.metadata&&(w.flowMetadata=Q.metadata);Q.statusCode!==void 0&&(w.flowEventStatus=Q.statusCode);Q.csn&&(w.csn=Q.csn);Q.can&&(w.can=Q.can);g.Vg("flowEvent",w,void 0)},VQ2=async function(w){var Q=await qf(w,{mode:"readonly",
UQ:!0},m=>k3(m,"playbackData").then(S=>{var V=S.map(f=>f.transfer).filter(f=>!!f),y=S.map(f=>f.offlineVideoPolicy).filter(f=>!!f),q=S.filter(f=>!!f.key).map(f=>g.J3(g.GJ(f.key).entityId,"downloadStatusEntity"));
V=k3(m,"transfer",V);y=k3(m,"offlineVideoPolicy",y);q=k3(m,"downloadStatusEntity",q);const a=V.then(f=>{f=f.reduce((O,Jj)=>{Jj?.offlineVideoStreams&&O.push(...Jj.offlineVideoStreams);return O},[]).filter(O=>!!O);
return k3(m,"offlineVideoStreams",f)});
return g.eJ.all([V,y,a,q]).then(([f,O,Jj,tj])=>[S,f,O,Jj,tj])}));
w=await qf(w,{mode:"readonly",UQ:!0},m=>k3(m,"mainDownloadsListEntity").then(S=>S[0]?.downloads??[]));
const [G,J,N,C,W]=Q,t={},L={},v={},B={},M={};Q=[];for(var I of J)I&&(t[I.key]=I);for(const m of N)m&&(L[m.key]=m);for(const m of W)m&&(v[m.key]=m);for(const m of C)m&&(B[m.key]=m);for(const m of w)M[m.videoItem??""]=!0,m.videoItem&&(I=g.GJ(m.videoItem)?.entityId??"",Q.push({externalVideoId:I}));return{offlineVideos:G.filter(m=>{if(!m||!m.key||!m.offlineVideoPolicy)return!1;m=g.GJ(m.key).entityId;m=g.J3(m,"downloadStatusEntity");return!(m&&v[m]?.downloadState==="DOWNLOAD_STATE_USER_DELETED")}).map(m=>
{var S=t[m.transfer];
const V=[];if(S?.offlineVideoStreams)for(var y of S.offlineVideoStreams){var q=B[y];q&&V.push(q)}y=L[m.offlineVideoPolicy];q=m?.playerResponseTimestamp;var a=g.GJ(y.key).entityId;m=g.J3(a,"mainVideoEntity");if(y.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var f="OFFLINE_VIDEO_STATE_DISABLED";y.expirationTimestamp&&Number(y.expirationTimestamp)<Date.now()/1E3&&(f="OFFLINE_VIDEO_STATE_EXPIRED")}else if(y.action==="OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")f="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";
else{switch(S?.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":f="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":f="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":f="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":f="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":f="OFFLINE_VIDEO_STATE_PLAYABLE";break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":f="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";
break;default:f="OFFLINE_VIDEO_STATE_UNKNOWN"}if(f==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(S?.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":f="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":f="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":f="OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}a={id:a,videoState:f};
S?.cotn&&(a.cotn=S.cotn);S?.maximumDownloadQuality&&(a.selectedVideoQuality=S?.maximumDownloadQuality);S?.lastProgressTimeMs&&(a.lastProgressTimeMs=S.lastProgressTimeMs);q&&(a.playerResponseSavedTimeMs=String(Number(q)*1E3));S=String;q=0;for(const O of V)if(O.streamsProgress)for(const Jj of O.streamsProgress)q+=Number(Jj.numBytesDownloaded??0);a.downloadedBytes=S(q);a.selectedOfflineMode=M[m]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";y.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(a.offlinePlaybackDisabledReason=
y.offlinePlaybackDisabledReason);return a}),
additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:Q}}}},kil=function(){try{let G=g.Pb("ytglobal.locks_");
if(G)return G;var w;if(w=navigator){var Q=navigator;w="locks"in Q&&!!Q.locks}if(w)return g.cb.localStorage&&g.cb.localStorage.getItem("noop"),G=new Z5h,g.Kq("ytglobal.locks_",G),G}catch{}},Pi=function(w){if(w.includes(":"))throw Error(`Invalid user cache name: ${w}`);
return`${w}:${g.xW("CacheStorage get")}`},rto=async function(){return gC!==void 0?gC:gC=new Promise(async w=>{try{await ej.open("test-only"),await ej.delete("test-only")}catch(Q){if(Q instanceof Error&&Q.name==="SecurityError"){w(!1);
return}}w("caches"in window)})},hC=async function(){if(await rto())return Hi||(Hi=new ytR),Hi},jj=function(w,Q,G){g.Ou(new g.Gu(`Woffle: ${w}`,G?{cotn:G}:""));
Q instanceof Error&&g.Ou(Q)},D3L=async function(w){w=await VQ2(w);
g.Vg("offlineStateSnapshot",w)},En=function(w,Q){g.hU(w.api,"onOfflineOperationFailure",Q);
w.Y?.postMessage(Q)},aWd=function(w){if(!w.A&&!w.Y){var Q=kil();
if(Q){w.A=!0;var G=g.xW("OfflineLockManager");Q.request(`${"woffle_orchestration_leader"}:${G}`,{},async()=>{try{w.W=new g.s8,w.Y=!0,w.A=!1,await w.O(),await w.W.promise}catch(J){w.U$(),J instanceof Error&&(J.args=[{name:"WoLockManagerError",zF:J.name}],g.P(J))}})}}},Tq=function(w){w.Z&&w.G&&w.J&&w.visibility.isBackground()?w.L.mF(6E4):w.L.stop()},YHb=function(w){w.Y&&(w.J=!0,Tq(w))},nc3=function(w,Q){w.Y&&(w.G=Q,Tq(w))},qHL=function(w,Q){w.Y&&(w.Z=Q,Tq(w))},pA=function(w){w.offlineDeleteReason=w.offlineDeleteReason??
"OFFLINE_DELETE_REASON_UNKNOWN";
w.offlineModeType=w.offlineModeType??"OFFLINE_NOW";g.Vg("offlineDeleteEvent",w)},uE=function(w,{videoId:Q,
Xs:G,offlineModeType:J}){w.encryptedVideoId=Q;w.cotn=G?.cotn;w.offlineabilityFormatType=G?.maximumDownloadQuality;w.isRefresh=G?.isRefresh??!1;w.softErrorCount=G?.transferRetryCount??0;w.offlineModeType=J??"OFFLINE_NOW";(w.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&w.statusType==="UNKNOWN_STATUS_TYPE"||!w.transferStatusType&&!w.statusType)&&g.Ou(Error("Woffle unknown transfer status"));g.Vg("offlineTransferStatusChanged",w)},fW4=function(w,Q,G,J){J={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!J};Q&&G&&(Q=Math.floor(Q/1024).toFixed(),G=Math.floor(G/1024).toFixed(),J.alreadyDownloadedKbytes=Q,J.totalFetchedKbytes=Q,J.totalContentKbytes=G);uE(J,w)},d33=function(w){uE({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},w)},zmd=function(w){switch(w){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
wZ=function(w){return(w.actionMetadata?.retryScheduleIntervalsInSeconds?.length??0)>0},ia=function(w){return w.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!w.entityKey},QW=function(w){return w.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!w.entityKey},Gs=function(w){return w.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!w.entityKey},ct2=function(w){return w.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!w.entityKey},Jg=async function(w,Q,G,J,N=!1){const C=
g.J3(w,Q),W=g.J3(w,"downloadStatusEntity");
w=await qf(G,{mode:"readonly",UQ:!0},L=>g.eJ.all([Zk(L,C,Q),Zk(L,W,"downloadStatusEntity")]));
const t=w.length?w[0]:void 0;if(t){let L=w.length>1?w[1]:void 0;if(L){if(L.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!N)return;L.downloadState=J}else L={key:W,downloadState:J};g.eh(t,Rm3,L);await qf(G,{mode:"readwrite",UQ:!0},v=>g.eJ.all([Dk(v,t,Q),Dk(v,L,"downloadStatusEntity")]))}},Ni=function(w,Q){return w.actionType===Q.actionType&&w.entityKey===Q.entityKey},C8=function(w,Q){if(w&&w.transferState!=="TRANSFER_STATE_COMPLETE"&&w.transferState!=="TRANSFER_STATE_FAILED"){const G=g.GJ(w.key).entityId;
uE({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:G,Xs:w,offlineModeType:Q})}},Wz=function(w){if(!w||!w.thumbnails)return[];
const Q=[];for(const G of w.thumbnails)G.url&&Q.push(G.url);return Q},tg=async function(w,Q,G=[]){if(!G.length)return[];
Q=await ci(w,Q);w=new Set;for(var J of Q)if(Q=J.id||J.key)Q=g.GJ(Q).entityId,w.add(Q);J=[];for(const N of G)G=N.offlineVideoData,G?.videoId&&!w.has(G.videoId)&&J.push(N);return J},L8=function(w,Q,G){return new g.mH(w,{cotn:Q,
raw_player_response:G,download_media:!0,start:Infinity,disable_watch_next:!0})},vz=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Bz=function(w){if(!w.key)throw Error("Entity key is required.");
if(!w.actionProto)throw Error("OfflineOrchestrationAction is required.");const Q=g.GJ(w.key),G=g.GJ(w.actionProto.entityKey);return new sN(G.entityType,Q.entityId,w.actionProto,w.parentActionId,w.rootActionId,w.childActionIds,w.prereqActionId,w.postreqActionIds,w.retryScheduleIndex,w.hasChildActionFailed,Number(w.enqueueTimeSec)*1E3)},Mi=function(w){return{key:g.J3(w.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:w.action,parentActionId:w.parentActionId,rootActionId:w.rootActionId,childActionIds:w.childActionIds,prereqActionId:w.prereqActionId,postreqActionIds:w.postreqActionIds,retryScheduleIndex:w.retryScheduleIndex,hasChildActionFailed:w.hasChildActionFailed,enqueueTimeSec:(w.Y/1E3).toFixed()}},O5k=async function(){const w=await hC();
return w?w.delete("yt-player-local-img"):!0},Ia=async function(w){const Q=await hC();
if(!Q)throw Error("Cache API not supported");if(w.length){var G=await Q.open("yt-player-local-img");await Promise.all(w.map(J=>G.delete(J)))}},oa=async function(w){const Q=await hC();
if(!Q)throw Error("Cache API not supported");w.length&&await (await Q.open("yt-player-local-img")).addAll(w)},$R=async function(w,Q,G,J,N){const C=g.J3(w,"mainVideoEntity"),W=g.J3(w,"ytMainChannelEntity"),t=g.J3(w,"transfer"),L=g.J3(w,"videoDownloadContextEntity");
var v=await qf(Q,{mode:"readonly",UQ:!0},f=>g.eJ.all([Zk(f,C,"mainVideoEntity"),Zk(f,W,"ytMainChannelEntity"),Zk(f,t,"transfer"),Zk(f,L,"videoDownloadContextEntity"),k3(f,"ytMainChannelEntity"),k3(f,"offlineOrchestrationActionWrapperEntity")]));
const [B,M,I,m,S,V]=v;if(B||M){v=B?Wz(B.thumbnail):[];var y=M?await lWk(M,S):[];await Ia(v.concat(y))}const q=[],a=g.J3(w,"downloadStatusEntity");for(const f of V)v=g.GJ(f.key).entityId,y=Bz(f),y=g.GJ(y.action.entityKey).entityId,v!==w&&y!==w||Ni(G,f.actionProto)||q.push(f.key);await qf(Q,{mode:"readwrite",UQ:!0},f=>{const O=q.map(Jj=>Y3(f,Jj));
O.push(Y3(f,C,{cV:!0}));O.push(Y3(f,a,{cV:!0}));return g.eJ.all(O)});
w=m?.offlineModeType;N&&(pA(N),N.offlineModeType&&(w=N.offlineModeType));C8(I,w);En(J,{entityKey:C,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"})},mh=async function(w,Q,G,J){const N=g.J3(w,"mainPlaylistEntity"),C=g.J3(w,"ytMainChannelEntity");
var W=await qf(Q,{mode:"readonly",UQ:!0},f=>g.eJ.all([Zk(f,N,"mainPlaylistEntity"),Zk(f,C,"ytMainChannelEntity"),k3(f,"mainPlaylistEntity"),k3(f,"mainDownloadsListEntity"),k3(f,"ytMainChannelEntity"),k3(f,"offlineOrchestrationActionWrapperEntity")]));
const [t,L,v,B,M,I]=W;if(t||L){W=t?Koo(t):[];var m=L?await lWk(L,M):[];await Ia(W.concat(m))}W=[];m=new Map;if(t){W=await P44(t,v,B);for(var S of W)m.set(S,{videoId:S,playlistId:w,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});S=await qf(Q,{mode:"readonly",UQ:!0},Jj=>g.eJ.all([k3(Jj,"transfer"),k3(Jj,"videoDownloadContextEntity")]));
const [f,O]=S;for(var V of f)S=g.GJ(V.key).entityId,(S=m.get(S))&&V&&(S.cotn=V.cotn);for(var y of O)V=g.GJ(y.key).entityId,(V=m.get(V))&&y&&(V.offlineModeType=y.offlineModeType)}const q=[];for(const f of I)y=g.GJ(f.key).entityId,V=Bz(f),y!==w&&V.rootActionId!==w||Ni(G,f.actionProto)||q.push(f.key);const a=g.J3(w,"mainPlaylistEntity");await qf(Q,{mode:"readwrite",UQ:!0},f=>{const O=q.map(Jj=>Y3(f,Jj));
O.push(Y3(f,a,{cV:!0}));return g.eJ.all(O)});
if(t&&(W.reverse(),W))for(const f of W)await $R(f,Q,G,J,m.get(f))},Ag=async function(w,Q,G,J){const N=g.J3("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),C=new Map;
w=await qf(w,{mode:"readwrite",UQ:!0},W=>{const t=k3(W,"transfer"),L=k3(W,"offlineOrchestrationActionWrapperEntity"),v=k3(W,"videoDownloadContextEntity"),B=Zk(W,N,"mainDownloadsListEntity");return g.eJ.all([t,L,v,B]).then(([M,I,m,S])=>{const V=gck.map(y=>nA(W,y));
for(const y of I)Ni(Q,y.actionProto)||V.push(Y3(W,y.key,{cV:!0}));S&&(S.downloads=[],V.push(Dk(W,S,"mainDownloadsListEntity")));if(m)for(const y of m)I=g.GJ(y.key).entityId,I=g.J3(I,"transfer"),C.set(I,y.offlineModeType);return g.eJ.all(V).then(()=>M)})});
for(const W of w){C8(W,C.get(W.key));w=g.GJ(W.key).entityId;const t={videoId:w,offlineDeleteReason:J,cotn:W.cotn,offlineModeType:C.get(W.key)};pA(t);w=g.J3(w,"mainVideoEntity");En(G,{entityKey:w,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"})}await O5k()},Koo=function(w,Q){let G=[];
if(w.thumbnailStyleData)for(const J of w.thumbnailStyleData)G=G.concat(Wz(J?.value?.collageThumbnail?.coverThumbnail));w=Wz(Q);return G.concat(w)},P44=async function(w,Q,G){const J=[],N=new Set;
if(G.length)for(var C of G)if(C.downloads?.length)for(const W of C.downloads)W.videoItem&&(G=g.GJ(W.videoItem).entityId,N.add(G));if(w.videos){for(const W of w.videos)C=JSON.parse(g.GJ(W).entityId),C.videoId&&!N.has(C.videoId)&&J.push(C.videoId);for(const W of Q)if(W.key!==w.key&&(Q=W.videos))for(const t of Q)Q=JSON.parse(g.GJ(t).entityId),Q.videoId&&(Q=J.indexOf(Q.videoId),Q!==-1&&J.splice(Q,1))}return J},lWk=async function(w,Q){const G=Wz(w.avatar);
for(const J of Q)if(J.id!==w.id)for(const N of Wz(J.avatar))Q=G.indexOf(N),Q!==-1&&G.splice(Q,1);return G},emj=async function(w){const Q=g.k(w.frameworkUpdates,Fp);
w.frameworkUpdates&&Q&&await lE(Q)},hmj=function(w){if(w.onResponseReceivedActions?.length&&(w=g.k(g.k(w.onResponseReceivedActions[0],H5r),g.lMv)?.actions,w?.length))return w},j9h=async function(w){if(!w)return[];
w=await zq(w,g.Hx,"mainDownloadsListEntity");return w?.downloads?.length?w.downloads.map(Q=>Q.videoItem??""):[]},S4=async function(w,Q){const G=await Ec4(w,Q);
G&&await qf(w,{mode:"readwrite",UQ:!0},J=>{const N=[Dk(J,G.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];G.mainDownloadsListEntity&&N.push(Dk(J,G.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.eJ.all(N)})},Ec4=async function(w,Q){const G=g.J3("main_downloads_library_id","mainDownloadsLibraryEntity"),J=g.J3("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");
w=await qf(w,{mode:"readonly",UQ:!0},L=>g.eJ.all([Zk(L,G,"mainDownloadsLibraryEntity"),Zk(L,J,"mainDownloadsListEntity")]));
let [N,C]=w;w=N;let W=C;w||(w={id:G});for(const L of Q)if(L===g.Hx){if(w.smartDownloadsList)return;w.smartDownloadsList=L}else{var t=g.GJ(L).entityType;Q={};t==="mainPlaylistEntity"?Q.playlistItem=L:t==="mainVideoEntity"&&(Q.videoItem=L);if(!g.QN(Q)){if(W?.downloads){t=!1;for(const v of W.downloads)if(v.playlistItem===L||v.videoItem===L){t=!0;break}t||W.downloads.push(Q)}else W={id:J,downloads:[Q]};w.downloadsList=J}}return{mainDownloadsLibraryEntity:w,mainDownloadsListEntity:W}},Xp=async function(w,
Q){const G=g.J3("main_downloads_library_id","mainDownloadsLibraryEntity"),J=g.J3("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");
var N=await qf(w,{mode:"readonly",UQ:!0},L=>g.eJ.all([Zk(L,G,"mainDownloadsLibraryEntity"),Zk(L,J,"mainDownloadsListEntity"),Zk(L,g.Hx,"mainDownloadsListEntity")]));
const [C,W,t]=N;if(C){if(Q===g.Hx&&t?.downloads)t.downloads=[];else if(W?.downloads){N=g.GJ(Q).entityType;for(let L=0;L<W.downloads.length;L++){const v=W.downloads[L];if(N==="mainVideoEntity"&&v.videoItem===Q){W.downloads.splice(L,1);break}else if(N==="mainPlaylistEntity"&&v.playlistItem===Q){W.downloads.splice(L,1);break}}}await qf(w,{mode:"readwrite",UQ:!0},L=>{const v=[Dk(L,C,"mainDownloadsLibraryEntity")];W&&v.push(Dk(L,W,"mainDownloadsListEntity"));t&&v.push(Dk(L,t,"mainDownloadsListEntity"));
return g.eJ.all(v)})}},ba=async function(w,Q){const G=g.J3(Q,"transfer"),J=g.J3(Q,"videoDownloadContextEntity");
w=await qf(w,{mode:"readonly",UQ:!0},W=>g.eJ.all([Zk(W,G,"transfer"),Zk(W,J,"videoDownloadContextEntity")]));
const [N,C]=w;return{videoId:Q,cotn:N?.cotn,offlineModeType:C?.offlineModeType}},xR=async function(w,Q,G,J,N){const C=g.J3(w,"musicTrack"),W=g.J3(w,"transfer");
var t=await qf(Q,{mode:"readonly",UQ:!0},S=>g.eJ.all([Zk(S,C,"musicTrack"),Zk(S,W,"transfer"),k3(S,"musicTrack"),k3(S,"offlineOrchestrationActionWrapperEntity")]));
const [L,v,B,M]=t;L&&(t=await TBr(L,B),await Ia(t));const I=[];for(const S of M){t=g.GJ(S.key).entityId;var m=Bz(S);m=g.GJ(m.action.entityKey).entityId;t!==w&&m!==w||Ni(G,S.actionProto)||I.push(S.key)}await qf(Q,{mode:"readwrite",UQ:!0},S=>{const V=I.map(y=>Y3(S,y));
V.push(Y3(S,C,{cV:!0}));return g.eJ.all(V)});
C8(v);N&&pA(N);En(J,{entityKey:C,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"})},UN=async function(w,Q,G,J,N){const C=g.J3(w,Q),W=g.J3("music_downloads_library_id","musicDownloadsLibraryEntity");
var t=await qf(G,{mode:"readonly",UQ:!0},q=>g.eJ.all([Zk(q,C,Q),Zk(q,W,"musicDownloadsLibraryEntity"),k3(q,Q),k3(q,"offlineOrchestrationActionWrapperEntity")]));
const [L,v,B,M]=t;L&&(t=await TBr(L,B),await Ia(t));let I=[];t=new Map;if(L){I=await pgh(L,B,v);for(var m of I){const q=g.GJ(m).entityId;t.set(q,{videoId:q,playlistId:w,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"})}m=await ci(G,"transfer");for(var S of m)m=g.GJ(S.key).entityId,(m=t.get(m))&&S&&(m.cotn=S.cotn)}const V=[];for(const q of M)S=g.GJ(q.key).entityId,m=Bz(q),S!==w&&m.rootActionId!==w||Ni(J,q.actionProto)||V.push(q.key);const y=g.J3(w,Q);await qf(G,{mode:"readwrite",UQ:!0},
q=>{const a=V.map(f=>Y3(q,f));
a.push(Y3(q,y,{cV:!0}));return g.eJ.all(a)});
if(L&&(I.reverse(),I.length))for(const q of I)(w=g.GJ(q).entityId)&&await xR(w,G,J,N,t.get(w))},VW=async function(w,Q,G){w=await qf(w,{mode:"readwrite",
UQ:!0},J=>{const N=k3(J,"transfer"),C=k3(J,"offlineOrchestrationActionWrapperEntity");return g.eJ.all([N,C]).then(([W,t])=>{const L=ui3.map(v=>nA(J,v));
for(const v of t){t=g.GJ(v.actionProto.entityKey).entityType==="musicTrack";const B=v.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";Ni(Q,v.actionProto)||t&&(!t||B)||L.push(Y3(J,v.key,{cV:!0}))}return g.eJ.all(L).then(()=>W)})});
for(const J of w)C8(J),w=g.GJ(J.key).entityId,pA({videoId:w,offlineDeleteReason:void 0,cotn:J.cotn}),w=g.J3(w,"musicTrack"),En(G,{entityKey:w,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});await O5k()},wrj=function(w){let Q;
for(const G of w.additionalMetadatas)G.offlineMusicVideoData&&(Q=G.offlineMusicVideoData);return{id:g.J3(w.videoId,"musicTrack"),videoId:w.videoId,title:w.title,thumbnailDetails:w.thumbnail,lengthMs:String(Number(w.lengthSeconds)*1E3),albumTitle:Q?.releaseTitle,musicVideoType:Q?.musicVideoType,contentRating:{explicitType:Q?.explicitType},artistNames:Q?.byline||Q?.channelName,downloadMetadata:g.J3(w.videoId,"musicTrackDownloadMetadataEntity")}},pgh=async function(w,Q,G){const J=[],N=new Set;
if(G?.downloadedTracks?.length)for(const C of G.downloadedTracks)N.add(C);if(w.tracks){for(const C of w.tracks)N.has(C)||J.push(C);for(const C of Q)if(C.id!==w.id&&(Q=C.tracks))for(const W of Q)Q=J.indexOf(W),Q!==-1&&J.splice(Q,1)}return J},TBr=async function(w,Q){const G=Wz(w.thumbnailDetails);
for(const J of Q)if(J.id!==w.id)for(const N of Wz(J.thumbnailDetails))Q=G.indexOf(N),Q!==-1&&G.splice(Q,1);return G},ZE=async function(w,Q){var G=g.J3("music_downloads_library_id","musicDownloadsLibraryEntity");
let J=await zq(w,G,"musicDownloadsLibraryEntity");J||(J={id:G});G=g.GJ(Q).entityType;G==="musicTrack"?J.downloadedTracks?.includes(Q)||(J.downloadedTracks=(J.downloadedTracks??[]).concat(Q)):G==="musicPlaylist"?J.downloadedPlaylists?.includes(Q)||(J.downloadedPlaylists=(J.downloadedPlaylists??[]).concat(Q)):G!=="musicAlbumRelease"||J.downloadedAlbumReleases?.includes(Q)||(J.downloadedAlbumReleases=(J.downloadedAlbumReleases??[]).concat(Q));await fA(w,J,"musicDownloadsLibraryEntity")},kR=async function(w,
Q){var G=g.J3("music_downloads_library_id","musicDownloadsLibraryEntity");
if(G=await zq(w,G,"musicDownloadsLibraryEntity")){var J=g.GJ(Q).entityType;let N;J==="musicTrack"?N=G.downloadedTracks:J==="musicPlaylist"&&(N=G.downloadedPlaylists);if(N?.length)for(J=0;J<N.length;J++)if(N[J]===Q){N.splice(J,1);break}await fA(w,G,"musicDownloadsLibraryEntity")}},iVJ=function(w){var Q=w.videos;
w=[];const G=[];if(Q)for(const N of Q){var J=N.offlineVideoData.videoId;Q=g.J3(J,"musicTrack");J=g.J3(J,"musicTrackDownloadMetadataEntity");w.push(Q);G.push(J)}return{vZ:w,kR:G}},rZ=function(w,Q,G){Q={track:wrj(Q)};
G&&(Q.playlistId=G);if(w=g.k(w.actionMetadata,QfL))Q.maximumDownloadQuality=w.maximumDownloadQuality;return{musicTrackEntityActionMetadata:Q}},JVl=async function(w){var Q=g.iO();
w=At4(w);const G=g.$A(Gm3);try{var J=await g.uh(Q,w,G,void 0,{JI:!0})}catch(N){if(N instanceof g.eG)throw J=`GetOffline network manager error: ${N.message}`,jj(J,N),Error(J);jj("GetOffline fetch request error",N);throw Error("GetOffline fetch request error");}Q=J.errorMetadata?.status;if(!J)throw jj("Network request failed"),Error("Network request failed");if(Q!==void 0)yW(Q);else if(!J.videos||!J.videos.length)throw jj("No data"),Error("No data");return J.videos.map(N=>N.offlineVideoData)},DE=async function(w){var Q=
g.iO();
w=For(w);const G=g.$A(Gm3);try{var J=await g.uh(Q,w,G,void 0,{JI:!0})}catch(N){if(N instanceof g.eG)throw J=`GetOffline network manager error for playlist: ${N.message}`,jj(J,N),Error(J);jj("GetOffline fetch request error for playlist",N);throw Error("GetOffline fetch request error for playlist");}Q=J.errorMetadata?.status;if(!J)throw jj("Network request failed for playlist"),Error("Network request failed for playlist");if(Q!==void 0)yW(Q,"playlist");else if(!J.playlists||!J.playlists.length)throw jj("No data for playlist"),
Error("No data for playlist");return J.playlists.map(N=>N.offlinePlaylistData)},CjJ=async function(w,Q,G,J){const N=await On();
if(!N)return[];var C=[];J?.length?C=J:C=await ci(N,"mainPlaylistEntity");if(!C.length)return[];J=[];const W=Date.now()/1E3;for(const B of C){var t=B.downloadState?await zq(N,B.downloadState,"mainPlaylistDownloadStateEntity"):void 0,L=(C=B?.entityMetadata)&&C.nextAutoRefreshIntervalSeconds?Number(C.nextAutoRefreshIntervalSeconds):NaN;L=Number.isNaN(L)?w:L;var v=t?.lastSyncedTimestampMillis?Number(t?.lastSyncedTimestampMillis)/1E3:0;t=t?.addedTimestampMillis?Number(t?.addedTimestampMillis)/1E3:0;if(G||
!C||v+L<=W){L=[];if(B.videos?.length)for(const M of B.videos)v=JSON.parse(g.GJ(M).entityId),v.videoId&&L.push(v.videoId);v="0";C&&(v=String(Number(C.offlineLastModifiedTimestampSeconds??0).toFixed()));J.push({playlistId:B.playlistId,videoIds:L,offlineLastModifiedTimestamp:v,autoSync:Q,offlineDateAddedTimestamp:String(t.toFixed())})}}return J.length?await N3h(J):[]},W4o=async function(){var w=await On();
if(!w)return!1;w=await ci(w,"refresh");if(!w[0]?.refreshTime)return!1;w=Number(w[0].refreshTime);const Q=Date.now()/1E3;return isFinite(w)&&Q>=w},L42=async function(w,Q){let G;
try{const J=await tfb(w,Q);await emj(J);G=hmj(J)}catch(J){jj("getAndProcessSmartDownloadsResponse request or processing error",J)}return G},vCj=async function(w,Q,G,J){const N=await On();
if(!N)return[];var C=[];J?.length?C=J:C=await ci(N,"musicPlaylist");if(!C.length)return[];J=[];const W=Date.now()/1E3;for(const v of C){var t=(C=v?.entityMetadata)&&C.nextAutoRefreshIntervalSeconds?Number(C.nextAutoRefreshIntervalSeconds):NaN;const B=Number.isNaN(t)?w:t;let M=t=0;var L="DOWNLOAD_SYNC_STATE_UNKNOWN";v.downloadMetadata&&(L=await zq(N,v.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),t=Number(L?.addedTimestampMillis??"0")/1E3,M=Number(L?.lastModifiedTimestampMillis??"0")/1E3,
L=L?.syncState??"DOWNLOAD_SYNC_STATE_UNKNOWN");if(G||L!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||!C||Number(C.lastSyncedTimestampSeconds??0)+B<=W){C=[];if(v.tracks?.length)for(const I of v.tracks)C.push(g.GJ(I).entityId);J.push({playlistId:v.playlistId,videoIds:C,offlineLastModifiedTimestamp:String(M.toFixed()),autoSync:Q,offlineDateAddedTimestamp:String(t.toFixed())})}}return J.length?await N3h(J):[]},tfb=async function(w,Q){var G=g.iO(),J=await On();
let N;J&&(N=await VQ2(J));J=N;w={context:g.II(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:w},offlineClientState:J,clientStateRequestData:{preferredFormatType:Q}}}};Q=g.$A(sfJ);try{var C=await g.uh(G,w,Q,void 0,{JI:!0})}catch(W){if(W instanceof g.eG)throw C=`DPS network manager error for smart downloads: ${W.message}`,jj(C,W),Error(C);jj("DPS fetch request error for smart downloads",W);throw Error("DPS fetch request error for smart downloads");
}G=C.errorMetadata?.status;if(C)G!==void 0&&yW(G,"smart downloads");else throw jj("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return C},Mfb=async function(w,Q){var G=g.iO();
w={context:g.II(),videoPlaybackPositionEntities:w,lastSyncTimestampUsec:Q};Q=g.$A(B3r);try{var J=await g.uh(G,w,Q,void 0,{JI:!0})}catch(N){if(N instanceof g.eG)throw J=`VPPS network manager error: ${N.message}`,jj(J,N),Error(J);jj("VPPS fetch request error",N);throw Error("VPPS fetch request error");}G=J.errorMetadata?.status;if(J)G!==void 0&&yW(G,"position sync");else throw jj("Network request failed for position sync"),Error("Network request failed for position sync");return J},oCJ=async function(w,
Q,G){var J=g.iO(),N=G.refreshData,C=G.isEnqueuedForExpiredStreamUrlRefetch,W=G.wA,t=G.offlineSourceData;
G=G.mediaCapabilities;w={entityKey:w};N&&(w.refreshData=N);C&&(w.isExpiredStreamUrlRefetch=C);W&&(w.downloadParameters=W);t&&(w.offlineSourceData=t);Q={context:g.e_(Q),signatureTimestamp:20436,videos:[w]};G&&(Q.mediaCapabilities=G);N=g.$A(Ibk);try{var L=await g.uh(J,Q,N,void 0,{JI:!0})}catch(v){if(v instanceof g.eG)throw L=`GetPDE network manager error: ${v.message}`,jj(L,v),Error(L);jj("GetPDE fetch request error",v);throw Error("GetPDE fetch request error");}J=L.errorMetadata?.status;if(L)J!==void 0&&
yW(J,"PDE");else throw jj("Network request failed for PDE"),Error("Network request failed for PDE");return L},yW=function(w,Q){Q=Q?` for ${Q}`:"";
if(w===0)throw w=`Empty response body${Q}`,jj(w),Error(w);w=`Response with error${Q}`;jj(w);throw Error(w);},N3h=async function(w){var Q=g.iO();
w=SHb(w);const G=g.$A($00);try{var J=await g.uh(Q,w,G,void 0,{JI:!0})}catch(N){if(N instanceof g.eG)throw J=`offlinePlaylistSyncCheck network manager error: ${N.message}`,jj(J,N),Error(J);jj("offlinePlaylistSyncCheck fetch request error",N);throw Error("offlinePlaylistSyncCheck fetch request error");}Q=J.errorMetadata?.status;if(!J)throw jj("Network request failed for playlist sync"),Error("Network request failed for playlist sync");if(Q!==void 0)yW(Q,"playlist sync");else if(!J.offlinePlaylistSyncCheckDatas||
!J.offlinePlaylistSyncCheckDatas.length)throw jj("No data for playlist sync"),Error("No data for playlist sync");return J.offlinePlaylistSyncCheckDatas.map(N=>N.offlinePlaylistSyncCheckData)},m04=async function(w,Q){const G=new Map;
for(const J of Q)G.set(J,await w.W(J));return G},aa=function(w,Q,G,J,N,C){Q=g.J3(Q,G);
return{actionType:w,entityKey:Q,actionMetadata:{...C,priority:J,retryScheduleIntervalsInSeconds:N}}},S0l=async function(w,Q){var G=Q.entityKey;
const J=g.k(Q.actionMetadata,YR)?.isEnqueuedForExpiredStreamUrlRefetch;try{let C=void 0;C=await AV0(w,Q);let W;try{{const t=g.k(Q.actionMetadata,YR);var N=t?{maximumDownloadQuality:t.maximumDownloadQuality}:void 0}W=await oCJ(G,w.B,{isEnqueuedForExpiredStreamUrlRefetch:J,wA:N,offlineSourceData:C})}catch(t){const L=wZ(Q)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR";jj("PDE handleAdd error");return n8(Q,!1,void 0,
"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",L,"DOWNLOAD_STATE_FAILED")}await F40(w,W,Q);return n8(Q,!0,W.orchestrationActions)}catch(C){return w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",C instanceof g.O4&&C.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),jj("PDE handleAdd error"),n8(Q,!1,void 0,w,G,"DOWNLOAD_STATE_FAILED")}},
x0h=async function(w,Q){const G=Q.entityKey,J=g.GJ(G).entityId;
var N=await qf(w.Y,{mode:"readonly",UQ:!0},M=>{const I=Zk(M,G,"playbackData"),m=Zk(M,g.J3(J,"offlineVideoPolicy"),"offlineVideoPolicy");M=Zk(M,g.J3(J,"transfer"),"transfer");return g.eJ.all([I,m,M])});
const [C,W,t]=N;if(!C||!W)return n8(Q,!0);N=[];var L=C?.playerResponseJson?JSON.parse(C.playerResponseJson):null;if(t&&L&&w.B.U("html5_refresh_deprecated_downloads")){var v=Xrh(w,L,t);N=await bVb(w,t)}N={lastPlayerResponseTimestampSeconds:C.playerResponseTimestamp,offlineToken:W.offlineToken,formatIds:N};L={};t?.maximumDownloadQuality&&(L.maximumDownloadQuality=t.maximumDownloadQuality);try{let M=void 0;M=await AV0(w,Q);try{var B=await oCJ(G,w.B,{refreshData:N,wA:L,offlineSourceData:M,mediaCapabilities:v})}catch(I){const m=
wZ(Q)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR";jj("PDE handleRefresh error");return n8(Q,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",m,"DOWNLOAD_STATE_FAILED")}await F40(w,B,Q);return n8(Q,!0,B.orchestrationActions)}catch(M){return w="PDE handleRefresh error",M instanceof Error&&(w=`PDE handleRefresh error: ${M.message}`),v="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",
M instanceof g.O4&&M.type==="QUOTA_EXCEEDED"&&(v="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),jj(w),n8(Q,!1,void 0,v,B,"DOWNLOAD_STATE_FAILED")}},AV0=async function(w,Q){Q=g.GJ(Q.entityKey).entityId;
Q=g.J3(Q,"videoDownloadContextEntity");w=await zq(w.Y,Q,"videoDownloadContextEntity");return w?.offlineModeType?{offlineModeType:w.offlineModeType}:void 0},n8=function(w,Q,G,J,N,C){return new qi(Q?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",wZ(w),G,J,N,C)},F40=async function(w,Q,G){if(Q.frameworkUpdates&&g.k(Q.frameworkUpdates,Fp)){if(g.k(Q.frameworkUpdates,Fp).mutations&&g.k(Q.frameworkUpdates,Fp).mutations.length>0&&g.k(Q.frameworkUpdates,Fp).mutations[0].type===
"ENTITY_MUTATION_TYPE_DELETE"){const J=g.GJ(g.k(Q.frameworkUpdates,Fp).mutations[0].entityKey).entityId,N=await ba(w.Y,J),C=g.k(G.actionMetadata,YR)?.playlistId;
C&&(N.playlistId=C);N.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";g.Jv(w.B)?await $R(J,w.Y,G,w.A,N):g.wa(w.B)&&await xR(J,w.Y,G,w.A)}await lE(g.k(Q.frameworkUpdates,Fp))}},Xrh=function(w,Q,G){Q=L8(w.B,G.cotn,Q);
G=g.ou(Q);return g.Iuk(Q,G,w.B)},bVb=async function(w,Q){const G=[];
if(w=await qf(w.Y,{mode:"readonly",UQ:!0},J=>{const N=[],C=Q.offlineVideoStreams;if(C)for(const W of C)N.push(Zk(J,W,"offlineVideoStreams"));return g.eJ.all(N)}))for(const J of w)if(J?.streamsProgress){w=J.streamsProgress;
for(let N=0;N<w.length;N++){const C=JSON.parse(w[N].formatStreamBytes);G.push({itag:C.itag,lmt:C.lastModified,xtags:C.xtags})}}return G},U02=async function(w,Q){Q=wZ(Q);
w=await ci(w.Y,"videoPlaybackPositionEntity");if(w.length===0)return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q);try{const G=await f8.getInstance();if(!G)throw Error("prefStorage is undefined");const J=(await G.get("psi"))?.e0??"0",N=await Mfb(w,J),C={isPaused:N.watchHistoryPaused,e0:N.syncTimestampUsec};await G.set("psi",C);if(!C.isPaused){const W=g.k(N.frameworkUpdates,Fp);N.frameworkUpdates&&W&&await lE(W)}}catch(G){return jj("PPE handleRefresh error: "+(G instanceof Error?G.message:
"unknown error")),new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q)},ZVO=async function(w,Q){const G=wZ(Q),J=g.GJ(Q.entityKey).entityId;
try{const N=await f8.getInstance();if(!N)throw Error("prefStorage is undefined");const C=await N.get("psi"),W=g.k(Q.actionMetadata,VfO);if(C?.isPaused===!1&&W?.lastPlaybackPositionSeconds){const t={key:g.J3(J,"videoPlaybackPositionEntity"),videoId:J,lastPlaybackPositionSeconds:W.lastPlaybackPositionSeconds};await fA(w.Y,t,"videoPlaybackPositionEntity")}}catch(N){return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G)},km3=async function(w,Q){const G=wZ(Q);
try{const J=g.GJ(Q.entityKey).entityId;if(J==="!*$_ALL_ENTITIES_!*$")await NBR(w.Y);else{const N=g.J3(J,"videoPlaybackPositionEntity");await dC(w.Y,N)}}catch(J){return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G)},dZ=async function(w){return m3l(w)},rVl=async function(w){return(await g.KgP(w)).filter(Q=>!!Q.url).map(Q=>
Q.url)},zs=function(w,Q){var G=g.z3(Q);
if(G===1||G===0)return Promise.resolve();(G=w.player?.getVideoData().videoId===Q?w.player:null)&&G.stopVideo();w.A=0;return dZ(Q)},cz=function(w,Q,G=!1,J=!0){Q=typeof Q==="string"?Q:Q.videoDetails.videoId;
if(g.z3(Q)===2){var N=w.player?.getVideoData().videoId===Q?w.player:null;N&&N.stopVideo();g.ct(Q,2);w.A=2;G?yVk(w.Y):J&&D0d(w.Y)}},Y0o=async function(w,Q){const G=wZ(Q);
if(await zq(w.Y,Q.entityKey,"transfer"))return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G);try{await abj(w,Q)}catch(J){return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G)},nCl=async function(w,Q){const G=wZ(Q),J=await zq(w.Y,Q.entityKey,"transfer");
if(!J||J.transferState!=="TRANSFER_STATE_COMPLETE")return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G);try{await abj(w,Q,!0)}catch(N){return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G)},q00=async function(w,Q){const G=wZ(Q),J=g.GJ(Q.entityKey).entityId,N=await qf(w.Y,{mode:"readonly",
UQ:!0},t=>{const L=Zk(t,Q.entityKey,"transfer");t=Zk(t,g.J3(J,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.eJ.all([L,t])}),[C,
W]=N;if(!C||C.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G);try{C.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";await fA(w.Y,C,"transfer");const t=g.GJ(C.key).entityId;uE({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:t,Xs:C,offlineModeType:W?.offlineModeType})}catch(t){return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G)},abj=async function(w,Q,G=!1){const J=g.k(Q.actionMetadata,fbl),N=g.GJ(Q.entityKey).entityId,C=g.J3(N,"downloadStatusEntity");
var W=await qf(w.Y,{mode:"readonly",UQ:!0},B=>{const M=Zk(B,C,"downloadStatusEntity");B=Zk(B,g.J3(N,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.eJ.all([M,B])});
const [t,L]=W;W="TRANSFER_STATE_TRANSFER_IN_QUEUE";t?.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&(W="TRANSFER_STATE_PAUSED_BY_USER");const v={key:Q.entityKey,transferState:W,cotn:g.Ut(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:J?.maximumDownloadQuality,preferredAudioTrack:J?.preferredAudioTrack,transferRetryCount:0,isRefresh:G,hasLoggedFirstStarted:!1};await qf(w.Y,{mode:"readwrite",UQ:!0},B=>{const M=[];G&&M.push(Y3(B,g.J3(N,"offlineVideoStreams")));M.push(Dk(B,v,"transfer"));
return g.eJ.all(M)});
G&&await dZ(N);uE({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:N,Xs:v,offlineModeType:L?.offlineModeType})},z3k=function(w,Q,G,J){if(!w.action.entityKey)throw Error("entityKey is missing.");
const {zN:N,entityId:C}=g.GJ(w.action.entityKey),W={entityType:N,entityId:C,offlineOrchestrationActionType:w.action.actionType,orchestrationAction:{orchestrationActionId:w.actionId}};Q&&(W.offlineOrchestrationActionResult=Q.status,W.isRetryable=G?!1:Q.Y,Q.A&&(W.offlineOrchestrationFailureReason=d00(Q.A,W.isRetryable)));w.action.actionMetadata?.offlineLoggingData?.offlineModeType&&(W.offlineModeType=w.action.actionMetadata.offlineLoggingData.offlineModeType);J&&(W.additionalOrchestrationActions=J.map(t=>
({orchestrationActionId:t.actionId})));
return W},d00=function(w,Q){return w!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||Q?w==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&Q?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":w:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},Ra=function(w,Q){const G={offlineOrchestrationContext:z3k(w)};
Q=x30(Q,G);U3k(b5k(),Q,w.rootActionId)},ON=function(w,Q,G,J=[]){Q={offlineOrchestrationContext:z3k(w,Q,G,J)};
Q=x30(3,Q);U3k(b5k(),Q,w.rootActionId)},cVd=function(w,Q){for(const G of Q)Ra(G,1),w.actions.push(G);
w.actions.sort(w.Y)},R30=function(w,Q){if(Q)for(let G=0;G<w.actions.length;G++)if(Q==="!*$_ALL_ENTITIES_!*$"&&w.actions[G].actionId!==Q||Q!=="!*$_ALL_ENTITIES_!*$"&&w.actions[G].rootActionId===Q&&w.actions[G].actionId!==Q)w.actions.splice(G,1),G--},OVr=function(w,Q){for(const G of w.actions)if(G.actionId===Q)return!0;
return!1},gCO=async function(w,Q,G,J,N){w=new lbj(w,Q,G,J,N);
await K4O(w);Pjo(w);return w},K4O=async function(w){const Q=await ci(w.W,"offlineOrchestrationActionWrapperEntity");
await la(w,Q)},Pjo=function(w){const Q=w.Y.actions[0];
return w.L?(Q?.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&w.L[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(w.J=!0),Promise.resolve()):e3d(w)},e3d=async function(w){if(w.L)throw Error("Already processing an action");
if(!w.iV()){var Q=w.Y.actions.shift();nc3(w.Mc,!Q);if(Q!==void 0){Q.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&Q.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&R30(w.Y,Q.actionId);var G="";Q.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&Q.rootActionId===Q.actionId&&(G=Q.actionId);var J=[Q];w.L=J;if(Q=w.YB[Q.entityType]){for(const N of J)Ra(N,2);try{const N=await m04(Q,J.map(C=>C.action));
for(const C of J){const W=N.get(C.action);await HVr(w,C,W)}R30(w.Y,G)}catch(N){jj("Orchestration error",N);try{await h33(w,J)}catch(C){jj("Orchestration retry error",C);for(const W of J)W.retryScheduleIndex<3&&cVd(w.Y,[W])}}finally{w.L=void 0}}else w.L=void 0;await e3d(w)}}},HVr=async function(w,Q,G){var J=Q.retryScheduleIndex+2===3;
if(G.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){var N=void 0;try{N=G.L?.map(C=>w.createAction(C,Q))}catch(C){ON(Q,G,J);
En(w.Z,{entityKey:Q.action.entityKey,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"});jj("Orchestration subactions creation error",C);return}ON(Q,G,J,N);if(N){const C=N.map(t=>Mi(t));
let W=0;for(;W<N.length&&!w.J;)await qf(w.W,{mode:"readwrite",UQ:!0},t=>{const L=[];L.push(aU(t,C.slice(W,W+10),"offlineOrchestrationActionWrapperEntity"));return g.eJ.all(L)}),W+=10;
if(w.J){w.J=!1;return}}G=Mi(Q);await dC(w.W,G.key);Ra(Q,4)}else if(G.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE")if(ON(Q,G,J),G.Y&&Q.retryScheduleIndex+1<3)await h33(w,[Q]);else{J={entityKey:Q.action.entityKey,failureReason:G?.W?G.W:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN"};N=void 0;g.Jv(w.B)?N="mainVideoDownloadStateEntity":g.wa(w.B)&&(N="musicTrackDownloadMetadataEntity");if(N&&G.downloadState){const C=g.GJ(Q.action.entityKey).entityId;await Jg(C,N,w.W,G.downloadState)}En(w.Z,J);G.downloadState===
"DOWNLOAD_STATE_FAILED"&&w.B.U("html5_auto_retry_failed_pde_actions")||(jj("Orchestration result is not retryable, deleting action"),await dC(w.W,Mi(Q).key))}},h33=async function(w,Q){for(const G of Q){const J=G.action?.actionMetadata?.retryScheduleIntervalsInSeconds||[1,
2,4];let N=1;G.retryScheduleIndex<J.length&&(N=J[G.retryScheduleIndex]);G.Y=N*1E3+Date.now();G.retryScheduleIndex++}await jfl(w,Q)},ECr=async function(w,Q){return(await ci(w.W,"offlineOrchestrationActionWrapperEntity",Q)).filter(s9h)},la=async function(w,Q){let G=[];
var J=Infinity;let N=4E3;for(const W of Q){Q=Number(W.enqueueTimeSec);const t=T3R(Q);var C=W.retryScheduleIndex;C=C!=null&&C>0;t>0&&C?(J=Math.min(J,Q),N=Math.min(t,N)):G.push(W)}isFinite(J)&&(!w.A.isActive()||J<w.O)&&(w.O=J,w.A.start(N));w.G.E3()||(J=G.length,G=G.filter(W=>!pro.includes(W.actionProto?.actionType||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN")),J=G.length<J,!w.A.isActive()&&J&&w.A.start(1));
G.length>0&&uBO(w,G);await Pjo(w)},T3R=function(w){w=w*1E3-Date.now();
return w>4E3?4E3:w},uBO=function(w,Q){Q.length!==0&&Q.forEach(G=>{G=Bz(G);
G.retryScheduleIndex<3&&cVd(w.Y,[G])})},wwj=async function(w){var Q=await ECr(w);
const G=[];for(const J of Q)Q=g.GJ(J.key).entityId,OVr(w.Y,Q)||G.push(J);await la(w,G)},jfl=function(w,Q){if(Q.length===0)return Promise.resolve([]);
Q=Q.map(G=>Mi(G));
return Jt3(w.W,Q)},iFo=async function(w,Q){const G=Q.videoId;
let J=!0;if(Q.captionTracks.length){const N=Raj(Q);w.Y=new g.Vp(w.Z0,Q,N)}else if(Q.Rb)w.Y=new g.ZM(w.Z0,Q.Rb,G,g.CfX(Q),Q.qS,Q.eventId),J=Q.qS;else return;return new Promise(N=>{w.Y?.J({Ys:async()=>{await w.Ys(G,J);N()},
Pm:()=>{}})})},QMo=async function(w){w=await $3r(w);
return!!w&&w.length>0},GIh=async function(w,Q){if(Q.length===0)return[];
const G=Q.map(N=>g.J3(N,"transfer")),J=(await ci(w.Y,"transfer",G)).filter(s9h).map(N=>g.GJ(N.key).entityId);
w=Q.filter(N=>J.indexOf(N)===-1);
if(w.length===0)return[];for(const N of w)await dZ(N);return w},Cd3=async function(w,Q,G,J,N,C){let W="STREAM_TYPE_UNKNOWN";
G.video&&G.audio?(W="STREAM_TYPE_AUDIO_AND_VIDEO",jj("unexpected stream type")):G.video&&!G.audio?W="STREAM_TYPE_VIDEO":!G.video&&G.audio&&(W="STREAM_TYPE_AUDIO");const t=g.J3(Q,"offlineVideoStreams"),L={numBytesDownloaded:N.toFixed(),numTotalBytes:C.toFixed(),streamType:W,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(J),itag:W==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(G.itag):void 0};await qf(w,{mode:"readwrite",UQ:!0},v=>{const B=Zk(v,t,"offlineVideoStreams"),M=Zk(v,
g.J3(Q,"transfer"),"transfer");return g.eJ.all([B,M]).then(([I,m])=>{if(!m)return Y3(v,t).then(()=>{});
var S=Jmr(I);I=N2j(I,J,L,t);const V=Dk(v,I,"offlineVideoStreams");Jmr(I)>S&&(m.lastProgressTimeMs=Date.now().toString());S=[V];m.offlineVideoStreams||(m.offlineVideoStreams=[]);m.offlineVideoStreams.indexOf(t)===-1&&(m.offlineVideoStreams.push(t),S.push(Dk(v,m,"transfer")));return g.eJ.all(S)})})},Wsj=async function(w,Q){Q=g.J3(Q,"offlineVideoStreams");
if((Q=await zq(w,Q,"offlineVideoStreams"))&&Q.streamsProgress){for(const G of Q.streamsProgress)G.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",G.numTotalBytes!==G.numBytesDownloaded&&(G.numBytesDownloaded=G.numTotalBytes);await fA(w,Q,"offlineVideoStreams")}},N2j=function(w,Q,G,J){if(w&&w.streamsProgress){J=w;
a:{Q=`${Q.itag};${Q.xtags}`;var N=w.streamsProgress;for(let C=0;C<N.length;C++){const W=JSON.parse(N[C].formatStreamBytes);if(`${W.itag};${W.xtags}`===Q){N[C]=G;G=N;break a}}N.push(G);G=N}J.streamsProgress=G}else w={key:J,streamsProgress:[G]};return w},Jmr=function(w){if(w?.streamsProgress){let Q=0;
w=w.streamsProgress;for(let G=0;G<w.length;G++){const J=w[G];isNaN(Number(J.numBytesDownloaded))?jj("stream progress bytes number invalid"):Q+=Number(J.numBytesDownloaded)}return Q}return 0},yVk=async function(w){if(w.Y){const Q=w.Y;
w.L.stop();await K8(w,"TRANSFER_STATE_PAUSED_BY_USER");const G=Q?.key?g.GJ(Q.key).entityId:"";G&&w.A&&await Jg(G,w.A,w.W,"DOWNLOAD_STATE_PAUSED");const J=await Pz(w,G);d33({videoId:G,Xs:Q,offlineModeType:J})}else gZ(w,"onTransferPausedByUser");e4(w);Hz(w)},D0d=async function(w){if(w.Y){w.L.stop();
await K8(w,"TRANSFER_STATE_TRANSFER_IN_QUEUE");var Q=w.Y;(Q=Q?.key?g.GJ(Q.key).entityId:"")&&w.A&&await Jg(Q,w.A,w.W,"DOWNLOAD_STATE_PAUSED");e4(w)}else gZ(w,"onTransferPausedByNetwork")},hg=async function(w){if(w.Y){w.L.start(108E5);
await K8(w,"TRANSFER_STATE_TRANSFERRING");var Q=w.Y;(Q=Q?.key?g.GJ(Q.key).entityId:"")&&w.A&&await Jg(Q,w.A,w.W,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS")}else gZ(w,"onTransferStart")},tqk=async function(w,Q,G){if(w.Y){w.Y.transferState!=="TRANSFER_STATE_TRANSFERRING"&&await hg(w);
var J=Date.now();J-w.RT>1E3&&(w.RT=J,await Cd3(w.W,G.videoId,G.W,G.D5,G.bytesDownloaded,G.Y),!w.C||w.C&&J-w.Mc>w.lV)&&(w.Mc=J,J=await Pz(w,Q),fW4({videoId:Q,Xs:w.Y,offlineModeType:J},G.bytesDownloaded,G.Y));w.L.start(108E5)}else gZ(w,`onTransferProgress: ${Q}`)},vrj=async function(w){if(w.Y){var Q=w.Y;
w.L.stop();if(Q&&w.J){var G=L8(w.api.j(),Q.cotn,w.J);await LsR(w,G)}await K8(w,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE");(G=Q?.key?g.GJ(Q.key).entityId:"")&&w.A&&await Jg(G,w.A,w.W,"DOWNLOAD_STATE_COMPLETE");await Wsj(w.W,G);var J=await Pz(w,G);uE({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",statusType:"SUCCESS"},{videoId:G,Xs:Q,offlineModeType:J});e4(w);Hz(w)}else gZ(w,"onTransferComplete")},sMJ=async function(w){await IWL();
w=w.PL;var Q=g.di();Q=Object.keys(Q);await GIh(w,Q)},I$l=async function(w){w=(await ci(w.W,"transfer")).filter(B23).sort(Mq4);
return w.length===0?void 0:w[0]},mTh=async function(w,Q){if(!w.O){w.O=!0;
w.Y=Q;var G=g.GJ(w.Y.key).entityId;if(w.Y.transferState==="TRANSFER_STATE_TRANSFERRING"){var J=await Pz(w,G);uE({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:G,Xs:w.Y,offlineModeType:J})}else w.Y.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||w.Y.transferRetryCount||w.Y.hasLoggedFirstStarted||(J=await Pz(w,G),w.Y.hasLoggedFirstStarted=!0,await ord(w),fW4({videoId:G,Xs:w.Y,offlineModeType:J},void 0,void 0,!0));await hg(w);G=null;try{G=await $T0(w,
Q),w.J=G}catch(N){jj("error getting player response",N,Q.cotn);await w.a8("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING");return}J=L8(w.api.j(),Q.cotn,G);await LsR(w,J);J.I4=await rVl(J.videoId);G=w.Z;Q=Q.maximumDownloadQuality;J.getPlayerResponse();g.ct(J.videoId,2);G.A=2;G.W=!1;G.player?.dispose();G.player=G.api.O0(J);G.player.q2({localmediachange:G.XJ,signatureexpired:G.L_,statechange:G.L},G);G.U("html5_generate_content_po_token")&&G.player.Fq();Q=G.Cg(Q);G.player.uG(g.uv(Q,Q,!0,"m"),!1);G.player.qY(!1);
w.L.start(108E5)}},e4=function(w){w.Y=void 0;
w.J=void 0;w.L.stop()},Hz=async function(w,Q=!1){if(w.Y)throw Error("Already downloading a video");
w.Mc=0;w.O=!1;const G=await I$l(w);qHL(w.Fb,!G);G&&w.G.E3()?(Q&&await new Promise(J=>{g.cL(J,1E3)}),await mTh(w,G)):!G&&w.Y&&e4(w)},Pz=async function(w,Q){return(await zq(w.W,g.J3(Q,"videoDownloadContextEntity"),"videoDownloadContextEntity"))?.offlineModeType??void 0},Amk=async function(w){w.J&&(await zs(w.Z,w.J.videoDetails.videoId),e4(w))},LsR=async function(w,Q){try{(Q.captionTracks.length||Q.Rb)&&!await QMo(Q.videoId)&&await iFo(w.pA,Q)}catch(G){jj("Caption downloading error",G,Q.cotn)}},ord=
async function(w,Q){if(w.Y){var G=w.Y;
await qf(w.W,{mode:"readwrite",UQ:!0},J=>{const N=[Dk(J,G,"transfer")];Q&&N.push(Q(J));return g.eJ.all(N)})}},$T0=async function(w,Q){Q=g.GJ(Q.key).entityId;
Q=g.J3(Q,"playbackData");w=await zq(w.W,Q,"playbackData");if(w?.playerResponseJson)return JSON.parse(w.playerResponseJson);throw Error("No PlayerResponse found");},K8=async function(w,Q,G,J){if(w.Y){w.Y.transferState=Q;
w.Y.failureReason=J;try{await ord(w,N=>G?k3(N,"offlineVideoStreams",w.Y.offlineVideoStreams).then(C=>{for(const W of C)if(W&&W.streamsProgress)for(const t of W.streamsProgress)t.streamState=G;return aU(N,C.filter(W=>!!W),"offlineVideoStreams")}):g.eJ.resolve(void 0))}catch(N){N instanceof g.O4&&N.type==="QUOTA_EXCEEDED"&&await w.a8("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE")}}else gZ(w,`saveTransferState: ${Q}`)},gZ=function(w,Q){w.api.WL("woffle",{mcte:Q});
jj("missing current transfer entity.")},FsR=function(w){const Q=(w.Y.transferRetryCount||0)<3;
Q&&(w=w.Y,w.transferRetryCount=(w.transferRetryCount||0)+1);return Q},SI2=async function(w,Q="TRANSFER_FAILURE_REASON_UNKNOWN"){w.Y||gZ(w,`setTransferToFailed: ${Q}`);
var G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";Q==="TRANSFER_FAILURE_REASON_NETWORK"?G="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":Q==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED");await K8(w,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",Q);En(w.V,{entityKey:w.Y?.key,failureReason:G});G=w.Y?g.GJ(w.Y.key).entityId:"";const J=await Pz(w,G);w={videoId:G,Xs:w.Y,offlineModeType:J};G={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",
statusType:"FAILED"};Q&&(G.transferFailureReason=Q,G.failureReason=zmd(Q));uE(G,w)},B23=function(w){return j4[w.transferState]!==void 0},Mq4=function(w,Q){const G=j4[w.transferState],J=j4[Q.transferState];
return G!==J?G-J:Number(w.enqueuedTimestampMs)-Number(Q.enqueuedTimestampMs)},Xwo=async function(w){g.hU(w.api,"onOrchestrationBecameLeader");
await w.W_()},UTl=async function(w){const Q=await On();
if(Q){w.W=new bF3(Q,w.api,w.A,w.Y);var G=w.G(Q);w.O=await gCO(Q,G,w.A,w.Y,w.B);await xTd(w)}else jj("PES is undefined")},xTd=async function(w){if(w.W){w.W.Y||await Hz(w.W);
w.B.U("woffle_enable_main_downloads_library")&&await w.JU();w.B.U("html5_offline_playback_position_sync")&&(await w.RT(),await w.AA(864E5));await w.refreshAllStaleEntities(43200,!0);await w.C();w.B.U("html5_retry_downloads_for_expiration")&&await w.Ky();w.Mc=g.Rl(()=>{w.refreshAllStaleEntities(43200,!0);w.C()},9E5);
g.Zd(g.re(),()=>w.Hn());
var Q=await On();await D3L(Q);YHb(w.A)}else jj("transferManager is undefined")},Vq4=async function(){const w=await On();
if(!w)return[];const Q=Date.now()/1E3,G=await ci(w,"offlineVideoPolicy");for(const J of G)J.expirationTimestamp&&Number(J.expirationTimestamp)<Q&&(J.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE",J.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED",await fA(w,J,"offlineVideoPolicy"));return G.map(J=>J.key)},EN=async function(w,Q,G,J,N){var C=await On();
if(!C)return[];Q=Q.map(W=>{var t=g.J3(W,G);t={actionType:J,entityKey:t,actionMetadata:{...vz(),...N}};J!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(t.actionMetadata.priority=0);W=new sN(G,W,t);return Mi(W)});
C=Jt3(C,Q);aWd(w.A);return C},ZFk=async function(w,Q,G,J){const N=[];
for(const C of Q)if(!C.upToDate&&(!G||C.shouldAutoSyncMetadata)&&C.playlistId){Q={};switch(J){case "mainPlaylistEntity":Q={mainPlaylistEntityActionMetadata:{nextAutoRefreshIntervalSeconds:C.checkInSeconds,autoSync:G}};break;case "musicPlaylist":Q={musicPlaylistEntityActionMetadata:{autoSync:G}}}(Q=await EN(w,[C.playlistId],J,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Q))&&N.push(...Q)}return N},kIk=async function(w,Q){if(Q.length){const G=vz();
g.eh(G,YR,{isEnqueuedForExpiredStreamUrlRefetch:!0});w.api.WL("qrd",{v:Q.length});return EN(w,Q,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",G)}return[]},ymb=async function(w,Q){const G=wZ(Q);
var J=g.GJ(Q.entityKey).entityId;let N=[];try{N=await rm4(w,J),w.B.U("woffle_enable_main_downloads_library")&&N?.length&&await S4(w.Y,[Q.entityKey])}catch(W){return Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W instanceof g.O4&&W.type==="QUOTA_EXCEEDED"?(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):jj("Playlist add error"),new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
G,void 0,Q,J)}const C=[];w.B.U("html5_offline_prevent_redownload_downloaded_video")&&(N=await tg(w.Y,"mainVideoEntity",N));if(N?.length)for(const W of N)w=W.offlineVideoData,w?.videoId&&C.push(aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",w.videoId,"mainVideoEntity",Number(Q.actionMetadata?.priority||0)+1,Ts,p8(Q,w,J)));return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,C)},a$b=async function(w,Q){const G=wZ(Q);
var J=Q.entityKey,N=g.GJ(J).entityId,C=[],W=!1;N==="!*$_ALL_ENTITIES_!*$"?(W=!0,C=await ci(w.Y,"mainPlaylistEntity")):(J=await zq(w.Y,J,"mainPlaylistEntity"))&&C.push(J);if(!C?.length)return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G);var t=g.k(Q.actionMetadata,DTJ);J=t?.nextAutoRefreshIntervalSeconds;const L=t?.autoSync;let v=[],B=!0;t=!0;let M=!1;if(W||L!==!1){try{v=await CjJ(0,!!L,!0,C)}catch(V){V instanceof Error&&V.message==="No data"?N==="!*$_ALL_ENTITIES_!*$"?await Ag(w.Y,Q,w.A,
"OFFLINE_DELETE_REASON_UNAVAILABLE"):await mh(N,w.Y,Q,w.A):V instanceof Error&&V.message==="Empty response body"&&jj(V.message)}if(!v.length||!W&&v[0].playlistId!==N)return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G)}if(W){Q=[];for(var I of v)I.upToDate||L&&!I.shouldAutoSyncMetadata||!I.playlistId||Q.push(aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",I.playlistId,"mainPlaylistEntity",0,Ts,{mainPlaylistEntityActionMetadata:{nextAutoRefreshIntervalSeconds:I.checkInSeconds,autoSync:L}}));
return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,Q)}v.length&&(I=v[0],M=!!I.upToDate,L&&(B=I.shouldAutoSyncMetadata??!0,t=I.shouldAutoSyncVideos??!0,I.checkInSeconds&&(J=I.checkInSeconds)));if(M||!B)return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G);I=[];C=C[0];W=C.downloadState?await zq(w.Y,C.downloadState,"mainPlaylistDownloadStateEntity"):void 0;W=W?.addedTimestampMillis?String(W.addedTimestampMillis):void 0;try{I=await rm4(w,N,W,J)}catch(V){if(V instanceof Error&&V.message===
"No data for playlist")await mh(N,w.Y,Q,w.A);else if(V instanceof Error&&V.message==="Empty response body for playlist")jj(V.message);else return Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V instanceof g.O4&&V.type==="QUOTA_EXCEEDED"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,Q,N)}if(!t)return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G);w=[];J=new Map;if(I?.length)for(var m of I)t=m.offlineVideoData,t?.videoId&&J.set(t.videoId,t);m=new Map;t=[];if(C?.videos?.length)for(var S of C.videos)if(C=JSON.parse(g.GJ(S).entityId).videoId)J.has(C)?(m.set(C,J.get(C)),J.delete(C)):t.push(C);S=Number(Q.actionMetadata?.priority||0)+1;for(const [V,y]of J.entries())w.push(aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",V,"mainVideoEntity",S,Ts,p8(Q,y,N)));for(const [V,y]of m.entries())w.push(aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",V,"mainVideoEntity",
S,Ts,p8(Q,y,N)));for(const V of t)w.push(aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",V,"mainVideoEntity",0,Ts,{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:{playlistId:N}}));return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,w)},YIL=async function(w,Q){const G=wZ(Q);
try{const J=g.GJ(Q.entityKey).entityId;J==="!*$_ALL_ENTITIES_!*$"?await Ag(w.Y,Q,w.A,Q.actionMetadata?.offlineLoggingData?.offlineDeleteReason):(await mh(J,w.Y,Q,w.A),w.B.U("woffle_enable_main_downloads_library")&&await Xp(w.Y,Q.entityKey))}catch(J){return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G)},rm4=async function(w,Q,G,J){Q=await DE([Q]);
const {mainPlaylistEntity:N,CP:C}=await nrh(w,Q[0],G,J);w=Koo(N,C?.avatar);try{await oa(w)}catch(W){W instanceof Error&&W.message==="Failed to fetch"&&jj(W.message)}return Q[0].videos},p8=function(w,Q,G){Q={offlineVideoData:Q,
playlistId:G};if(w=g.k(w.actionMetadata,DTJ))Q.maximumDownloadQuality=w.maximumDownloadQuality;return{mainVideoEntityActionMetadata:Q}},nrh=async function(w,Q,G,J){const N=Date.now().toString();
G||(G=N);var C=Q.videos;const W=Q.playlistId,t=[],L=[];if(C)for(const I of C){C=I.offlineVideoData;if(!C||!C.videoId)throw jj("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");C=C.videoId;C={id:g.J3(JSON.stringify({videoId:C,playlistId:W}),"mainPlaylistVideoEntity"),video:g.J3(C,"mainVideoEntity")};t.push(C);L.push(C.id)}let v;const B={key:g.J3(W,"mainPlaylistDownloadStateEntity"),addedTimestampMillis:G,lastSyncedTimestampMillis:N},M={key:g.J3(W,"mainPlaylistEntity"),
playlistId:W,videos:L,title:Q.title,thumbnailStyleData:qIl(Q),visibility:f$d(Q),downloadState:B.key};Q.channel&&(G=Q.channel.offlineChannelData,v=dTr(g.J3(W,"ytMainChannelEntity"),G),M.channelOwner=v.id);M?.entityMetadata?(M.entityMetadata.offlineLastModifiedTimestampSeconds=Q.lastModifiedTimestamp,J&&(M.entityMetadata.nextAutoRefreshIntervalSeconds=String(J))):M&&(M.entityMetadata={nextAutoRefreshIntervalSeconds:J?String(J):void 0,offlineLastModifiedTimestampSeconds:Q.lastModifiedTimestamp});try{await qf(w.Y,
{mode:"readwrite",UQ:!0},I=>{var m=Dk(I,M,"mainPlaylistEntity");const S=Dk(I,B,"mainPlaylistDownloadStateEntity");m=[m,S];for(const V of t)m.push(Dk(I,V,"mainPlaylistVideoEntity"));v&&m.push(Dk(I,v,"ytMainChannelEntity"));return g.eJ.all(m)})}catch(I){throw jj("PES failure for playlist"),Error("PES failure for playlist");
}return{mainPlaylistEntity:M,CP:v,SvL:t}},qIl=function(w){const Q=[];
var G=w.videos;G&&G.length>0&&Q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:G[0].offlineVideoData.thumbnail}}});if((w=w.additionalMetadadatas)&&w.length>0)for(const J of w)switch(w=J.offlineBundleItemPlaylistData,G={collageThumbnail:{coverThumbnail:w?.coverThumbnail}},w?.style){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":Q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),value:G});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":Q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),
value:G});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":Q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:G});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":Q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:G})}return Q},f$d=function(w){switch(w.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},dTr=function(w,Q){return{id:w,
channelId:Q.channelId,title:Q.title,avatar:Q.thumbnail}},Rgo=async function(w,Q){const G=wZ(Q);
var J=g.GJ(Q.entityKey).entityId;const N=g.k(Q.actionMetadata,ua),C=!N?.playlistId;try{await zgJ(w,J,void 0,N?.offlineVideoData,C)}catch(W){return J="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W instanceof g.O4&&W.type==="QUOTA_EXCEEDED"&&(J="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,J,Q)}w=Number(Q.actionMetadata?.priority||
0)+1;Q=(Q=g.k(Q.actionMetadata,ua))?{playbackDataActionMetadata:{maximumDownloadQuality:Q.maximumDownloadQuality}}:void 0;J=aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J,"playbackData",w,cm0,Q);return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,[J])},OFh=async function(w,Q){const G=wZ(Q),J=g.GJ(Q.entityKey).entityId;
var N=await zq(w.Y,Q.entityKey,"mainVideoEntity"),C=N?await zq(w.Y,N.downloadState,"mainVideoDownloadStateEntity"):void 0;if(!N||!C)return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G);let W;try{await zgJ(w,J,C.addedTimestampMillis,g.k(Q.actionMetadata,ua)?.offlineVideoData),N=1,N=Number(Q.actionMetadata?.priority||0)+1,W=aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",J,"playbackData",N,cm0)}catch(t){if(t instanceof Error&&t.message==="No data"){N=await ba(w.Y,J);if(C=g.k(Q.actionMetadata,
ua)?.playlistId)N.playlistId=C;N.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";await $R(J,w.Y,Q,w.A,N)}else if(t instanceof Error&&t.message==="Empty response body")jj(t.message);else return w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.O4&&t.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
G,void 0,w,Q)}return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,W?[W]:void 0)},l$o=async function(w,Q){const G=wZ(Q);
try{const J=g.GJ(Q.entityKey).entityId;if(J==="!*$_ALL_ENTITIES_!*$")await Ag(w.Y,Q,w.A,Q.actionMetadata?.offlineLoggingData?.offlineDeleteReason);else{const N=await ba(w.Y,J),C=g.k(Q.actionMetadata,ua)?.playlistId;C&&(N.playlistId=C);N.offlineDeleteReason=Q.actionMetadata?.offlineLoggingData?.offlineDeleteReason;await $R(J,w.Y,Q,w.A,N);w.B.U("woffle_enable_main_downloads_library")&&await Xp(w.Y,Q.entityKey)}}catch(J){return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G)},zgJ=async function(w,Q,G,J,N){J||(J=(await JVl([Q]))[0]);
const {mainVideoEntity:C,channelEntity:W}=await Ks0(w,J,G,N);try{const t=Wz(C.thumbnail),L=Wz(W.avatar);await oa(t.concat(L))}catch(t){t instanceof Error&&t.message==="Failed to fetch"&&jj(t.message)}},Ks0=async function(w,Q,G,J){G||(G=Date.now().toString());
const N=Q.channel?.offlineChannelData,C={id:g.J3(Q.videoId,"ytMainChannelEntity"),channelId:N.channelId,title:N.title,avatar:N.thumbnail},W={key:g.J3(Q.videoId,"mainVideoDownloadStateEntity"),playbackData:g.J3(Q.videoId,"playbackData"),addedTimestampMillis:G,videoDownloadContextEntity:g.J3(Q.videoId,"videoDownloadContextEntity")},t={key:g.J3(Q.videoId,"videoPlaybackPositionEntity"),videoId:Q.videoId,lastPlaybackPositionSeconds:"0"};let L;w.B.U("html5_offline_playback_position_sync")&&(L={playbackPosition:t.key});
G=g.J3(Q.videoId,"mainVideoEntity");const v={key:G,videoId:Q.videoId,title:Q.title,thumbnail:Q.thumbnail,localizedStrings:{viewCount:Q.shortViewCountText},userState:L,lengthSeconds:Q.lengthSeconds?Number(Q.lengthSeconds):void 0,publishedTimestampMillis:Q.publishedTimestamp?(Number(Q.publishedTimestamp)*1E3).toString():void 0,formattedDescription:Q.description,owner:C.id,downloadState:W.key};let B,M;w.B.U("woffle_enable_main_downloads_library")&&J&&(J=await Ec4(w.Y,[G]))&&(B=J.mainDownloadsLibraryEntity,
M=J.mainDownloadsListEntity);let I;I={key:g.J3(Q.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"};g.eh(W,Rm3,I);await qf(w.Y,{mode:"readwrite",UQ:!0},m=>{var S=Dk(m,C,"ytMainChannelEntity"),V=Dk(m,W,"mainVideoDownloadStateEntity");const y=Dk(m,v,"mainVideoEntity");S=[S,V,y];w.B.U("html5_offline_playback_position_sync")&&(V=Dk(m,t,"videoPlaybackPositionEntity"),S.push(V));B&&(V=Dk(m,B,"mainDownloadsLibraryEntity"),S.push(V));M&&(V=Dk(m,M,"mainDownloadsListEntity"),S.push(V));
I&&(m=Dk(m,I,"downloadStatusEntity"),S.push(m));return g.eJ.all(S)});
return{mainVideoEntity:v,channelEntity:C}},grh=async function(w,Q){const G=wZ(Q),J=[];
var N=await f8.getInstance();let C,W;N&&(C=await N.get("sdois"),W=await N?.get("lmqf"));try{if(C===void 0)throw Error("prefStorage or opt-in state is undefined");N=[];C||(N=await j9h(w.Y),N.reverse());if(N.length)for(const v of N){if(!v)continue;const B=g.GJ(v).entityId,M=await ba(w.Y,B);M.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE";await $R(B,w.Y,{entityKey:v,actionType:Q.actionType},w.A,M)}const t=await tfb(C,W??"SD");await emj(t);const L=hmj(t);w.B.U("woffle_enable_main_downloads_library")&&
(C||await Xp(w.Y,g.Hx),await S4(w.Y,[g.Hx]));if(L?.length)for(const v of L){const B=v.actionType,M=v.entityKey,I=v.actionMetadata;if(B&&M&&I&&!g.k(I,Pd2)){B==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(I.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});const m=g.k(v.actionMetadata,ua);m&&(m.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",v.actionMetadata={...v.actionMetadata,mainVideoEntityActionMetadata:m});J.push(v)}}}catch(t){return w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",
Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.O4&&t.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,w,Q)}return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,J)},egL=async function(w,Q=43200,G=!0){if(!w.Z.E3())return[];
let J=[];try{J=await CjJ(Q,G,!1)}catch(N){N instanceof Error&&N.message==="No data"||N instanceof Error&&N.message==="Empty response body"&&jj(N.message)}return ZFk(w,J,G,"mainPlaylistEntity")},HF2=async function(w,Q,G,J=!1){let N=[];
if(!await W4o()&&!J)return[];G=await L42(Q,G);if(!G?.length)return[];Q={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};for(const W of G){G=W.actionType;var C=W.entityKey;J=W.actionMetadata;G&&C&&J&&!g.k(J,Pd2)&&(G==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(J.offlineLoggingData=Q),{entityId:C}=g.GJ(C),G=await EN(w,[C],"mainVideoEntity",G,J),N=N.concat(G))}return N},jMR=async function(w,Q){const G=wZ(Q);
var J=g.GJ(Q.entityKey).entityId;let N=[];try{N=await hgj(w,J),N?.length&&await ZE(w.Y,Q.entityKey)}catch(W){return Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W instanceof g.O4&&W.type==="QUOTA_EXCEEDED"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,Q,J)}const C=[];N=await tg(w.Y,"musicTrack",N);if(N.length)for(const W of N)w=
W.offlineVideoData,w?.videoId&&C.push(aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",w.videoId,"musicTrack",Number(Q.actionMetadata?.priority||0)+1,wW,rZ(Q,w,J)));return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,C)},ErO=async function(w,Q){const G=wZ(Q);
var J=Q.entityKey,N=g.GJ(J).entityId,C=[],W=!1;N==="!*$_ALL_ENTITIES_!*$"?(W=!0,C=await ci(w.Y,"musicAlbumRelease")):(J=await zq(w.Y,J,"musicAlbumRelease"))&&C.push(J);if(!C?.length)return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G);if(W){Q=[];for(var t of C){var L=g.GJ(t.id).entityId;Q.push(aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",L,"musicAlbumRelease",0,wW))}return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,Q)}t=[];C=C[0];W=void 0;C.downloadMetadata&&(W=await zq(w.Y,
C.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),W=Number(W?.addedTimestampMillis??"0")/1E3);try{t=await hgj(w,N,W?.toString())}catch(M){if(M instanceof Error&&M.message==="No data")await UN(N,"musicAlbumRelease",w.Y,Q,w.A);else if(M instanceof Error&&M.message==="Empty response body")jj(M.message);else return Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.O4&&M.type==="QUOTA_EXCEEDED"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
L="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,Q,L)}w=[];N=new Map;if(t?.length)for(var v of t)t=v.offlineVideoData,t?.videoId&&N.set(t.videoId,t);v=new Map;t=[];if(C?.tracks?.length)for(var B of C.tracks)if(C=g.GJ(B).entityId)N.has(C)?(v.set(C,N.get(C)),N.delete(C)):t.push(C);B=Number(Q.actionMetadata?.priority||0)+1;for(const [M,I]of N.entries())w.push(aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M,"musicTrack",B,wW,rZ(Q,I)));for(const [M,
I]of v.entries())w.push(aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",M,"musicTrack",B,wW,rZ(Q,I)));for(L of t)w.push(aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",L,"musicTrack",0,wW));return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,w)},T2d=async function(w,Q){const G=wZ(Q);
try{const J=g.GJ(Q.entityKey).entityId;J==="!*$_ALL_ENTITIES_!*$"?await VW(w.Y,Q,w.A):(await UN(J,"musicAlbumRelease",w.Y,Q,w.A),await kR(w.Y,Q.entityKey))}catch(J){return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G)},hgj=async function(w,Q,G){Q=await DE([Q]);
w=await pwh(w,Q[0],G);w=Wz(w.thumbnailDetails);await oa(w);return Q[0].videos},pwh=async function(w,Q,G){var J=Q.additionalMetadadatas;
let N=void 0;if(J&&J.length>0)for(var C of J)if(C.offlineMusicPlaylistData){N=C.offlineMusicPlaylistData;break}J=Q.playlistId;const {vZ:W,kR:t}=iVJ(Q);G=G?(Number(G)*1E3).toString():Date.now().toString();C=Q.lastModifiedTimestamp?(Number(Q.lastModifiedTimestamp)*1E3).toString():"0";const L={id:g.J3(J,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:t,lastModifiedTimestampMillis:C,addedTimestampMillis:G,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},v={id:g.J3(J,"musicAlbumRelease"),
title:Q.title,audioPlaylistId:J,trackCount:Q.totalVideoCount,tracks:W,downloadMetadata:L.id};N&&(v.thumbnailDetails=N.albumHqThumbnail??N.albumArtistThumbnail,v.artistDisplayName=N.albumArtistDisplayName,v.releaseDate=N.albumReleaseDate,v.contentRating={explicitType:N.albumReleaseExplicitType},v.releaseType=N.albumReleaseType);await qf(w.Y,{mode:"readwrite",UQ:!0},B=>{const M=Dk(B,v,"musicAlbumRelease");B=Dk(B,L,"musicAlbumReleaseDownloadMetadataEntity");return g.eJ.all([M,B])});
return v},w7d=async function(w,Q){const G=wZ(Q);
var J=g.GJ(Q.entityKey).entityId;let N=[];try{N=await u1d(w,J),N?.length&&await ZE(w.Y,Q.entityKey)}catch(W){return Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W instanceof g.O4&&W.type==="QUOTA_EXCEEDED"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,Q,J)}const C=[];N=await tg(w.Y,"musicTrack",N);if(N.length)for(const W of N)w=
W.offlineVideoData,w?.videoId&&C.push(aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",w.videoId,"musicTrack",Number(Q.actionMetadata?.priority||0)+1,iw,rZ(Q,w,J)));return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,C)},icd=async function(w,Q){const G=wZ(Q);
var J=Q.entityKey,N=g.GJ(J).entityId,C=[],W=!1;N==="!*$_ALL_ENTITIES_!*$"?(W=!0,C=await ci(w.Y,"musicPlaylist")):(J=await zq(w.Y,J,"musicPlaylist"))&&C.push(J);if(!C?.length)return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G);const t=g.k(Q.actionMetadata,QfL)?.autoSync;let L=[],v=!0;J=!0;let B=!1;var M=void 0;if(W||t!==!1){try{L=await vCj(0,!!t,!0,C)}catch(y){y instanceof Error&&y.message==="No data"?N==="!*$_ALL_ENTITIES_!*$"?await VW(w.Y,Q,w.A):await UN(N,"musicPlaylist",w.Y,Q,w.A):y instanceof
Error&&y.message==="Empty response body"&&jj(y.message)}if(!L.length||!W&&L[0].playlistId!==N)return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G)}if(W){Q=[];for(var I of L)I.upToDate||t&&!I.shouldAutoSyncMetadata||!I.playlistId||Q.push(aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",I.playlistId,"musicPlaylist",0,iw,{musicPlaylistEntityActionMetadata:{autoSync:t}}));return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,Q)}L.length&&(I=L[0],B=!!I.upToDate,t&&(v=I.shouldAutoSyncMetadata??
!0,J=I.shouldAutoSyncVideos??!0,I.checkInSeconds&&(M=I.checkInSeconds)));if(B||!v)return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G);I=[];C=C[0];W=void 0;C.downloadMetadata&&(W=await zq(w.Y,C.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),W=Number(W?.addedTimestampMillis??"0")/1E3);try{I=await u1d(w,N,W?.toString(),M)}catch(y){if(y instanceof Error&&y.message==="No data")await UN(N,"musicPlaylist",w.Y,Q,w.A);else if(y instanceof Error&&y.message==="Empty response body")jj(y.message);
else{Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";var m="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED";y instanceof g.O4&&y.type==="QUOTA_EXCEEDED"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE");return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,Q,m)}}if(!J)return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G);w=[];N=new Map;if(I?.length)for(var S of I)J=S.offlineVideoData,J?.videoId&&
N.set(J.videoId,J);S=new Map;J=[];if(C?.tracks?.length)for(var V of C.tracks)if(M=g.GJ(V).entityId)N.has(M)?(S.set(M,N.get(M)),N.delete(M)):J.push(M);V=Number(Q.actionMetadata?.priority||0)+1;for(const [y,q]of N.entries())w.push(aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",y,"musicTrack",V,iw,rZ(Q,q)));for(const [y,q]of S.entries())w.push(aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",y,"musicTrack",V,iw,rZ(Q,q)));for(m of J)w.push(aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",m,"musicTrack",0,iw));
return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,w)},Qgb=async function(w,Q){const G=wZ(Q);
try{const J=g.GJ(Q.entityKey).entityId;J==="!*$_ALL_ENTITIES_!*$"?await VW(w.Y,Q,w.A):(await UN(J,"musicPlaylist",w.Y,Q,w.A),await kR(w.Y,Q.entityKey))}catch(J){return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G)},u1d=async function(w,Q,G,J){Q=await DE([Q]);
w=await G9l(w,Q[0],G,J);w=Wz(w.thumbnailDetails);await oa(w);return Q[0].videos},G9l=async function(w,Q,G,J){const N=Q.playlistId,{vZ:C,
kR:W}=iVJ(Q);G=G?(Number(G)*1E3).toString():Date.now().toString();const t=Q.lastModifiedTimestamp?(Number(Q.lastModifiedTimestamp)*1E3).toString():"0",L={id:g.J3(N,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:W,lastModifiedTimestampMillis:t,addedTimestampMillis:G,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},v={id:g.J3(N,"musicPlaylist"),title:Q.title,playlistId:N,thumbnailDetails:Q.thumbnail,visibility:Jx0(Q),trackCount:Q.totalVideoCount,tracks:C,downloadMetadata:L.id};J&&(v?.entityMetadata?
v.entityMetadata.nextAutoRefreshIntervalSeconds=String(J):v&&(v.entityMetadata={nextAutoRefreshIntervalSeconds:String(J)}));await qf(w.Y,{mode:"readwrite",UQ:!0},B=>{const M=Dk(B,v,"musicPlaylist");B=Dk(B,L,"musicPlaylistDownloadMetadataEntity");return g.eJ.all([M,B])});
return v},Jx0=function(w){switch(w.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},WJj=async function(w,Q){const G=wZ(Q);
var J=g.GJ(Q.entityKey).entityId;const N=g.k(Q.actionMetadata,QA);try{await NNl(w,J,void 0,N?.track,N?.albumRelease),N?.playlistId||await ZE(w.Y,Q.entityKey)}catch(C){return Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",C instanceof g.O4&&C.type==="QUOTA_EXCEEDED"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,
void 0,Q,J)}w=(w=g.k(Q.actionMetadata,QA))?{playbackDataActionMetadata:{maximumDownloadQuality:w.maximumDownloadQuality}}:void 0;Q=aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J,"playbackData",Number(Q.actionMetadata?.priority||0)+1,C2L,w);return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,[Q])},tm4=async function(w,Q){const G=wZ(Q),J=g.GJ(Q.entityKey).entityId;
var N=await zq(w.Y,Q.entityKey,"musicTrack");const C=N?await zq(w.Y,N.downloadMetadata,"musicTrackDownloadMetadataEntity"):void 0;if(!N||!C)return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G);let W;N=g.k(Q.actionMetadata,QA);try{await NNl(w,J,C.addedTimestampMillis,N?.track,N?.albumRelease),W=aa("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",J,"playbackData",Number(Q.actionMetadata?.priority||0)+1,C2L)}catch(t){if(t instanceof Error&&t.message==="No data")await xR(J,w.Y,Q,w.A);else if(t instanceof
Error&&t.message==="Empty response body")jj(t.message);else return w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.O4&&t.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,w,Q)}return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,W?[W]:void 0)},LJ4=async function(w,
Q){const G=wZ(Q);
try{const J=g.GJ(Q.entityKey).entityId;J==="!*$_ALL_ENTITIES_!*$"?await VW(w.Y,Q,w.A):(await xR(J,w.Y,Q,w.A),await kR(w.Y,Q.entityKey))}catch(J){return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new qi("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G)},NNl=async function(w,Q,G,J,N){J||(J=(await JVl([Q]))[0],J=wrj(J));
const {musicTrackEntity:C,D2:W}=await vxr(w,J,Q,N,G);w=Wz(C.thumbnailDetails);Q=[];W&&(Q=Wz(W.thumbnailDetails));await oa(w.concat(Q))},vxr=async function(w,Q,G,J,N){N||(N=Date.now().toString());
const C={id:g.J3(G,"musicTrackDownloadMetadataEntity"),playbackData:g.J3(G,"playbackData"),addedTimestampMillis:N,videoDownloadContextEntity:g.J3(G,"videoDownloadContextEntity")};J&&(Q.albumRelease=J.id);await qf(w.Y,{mode:"readwrite",UQ:!0},W=>{const t=[];var L=Dk(W,C,"musicTrackDownloadMetadataEntity");t.push(L);L=Dk(W,Q,"musicTrack");t.push(L);J&&(W=Dk(W,J,"musicAlbumRelease"),t.push(W));return g.eJ.all(t)});
await Jg(G,"musicTrackDownloadMetadataEntity",w.Y,"DOWNLOAD_STATE_PENDING_DOWNLOAD");return{musicTrackEntity:Q,D2:J}},sgl=async function(w,Q=43200,G=!0){if(!w.Z.E3())return[];
let J=[];try{J=await vCj(Q,G,!1)}catch(N){}return ZFk(w,J,G,"musicPlaylist")},BN0=function(w){let Q;
w=g.k(w.getWatchNextResponse()?.currentVideoEndpoint,g.pH);w?.playlistId&&(Q=w.playlistId);return Q},Mmh=async function(w,Q){const G=Q.clientPlaybackNonce,J={cpn:G,
offlineSourceVisualElement:g.k6(Q.YB||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};Q.W&&(J.videoFmt=Number(Q.W.itag));Q.L&&(J.audioFmt=Number(Q.L.itag));const N=BN0(Q);var C;if(C=N&&Q.videoId)Q=Q.videoId,C=await (N!=="PPSV"?Promise.resolve(!1):w.Y.PL(Q));C&&(J.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");w.W=G;g.Vg("offlinePlaybackStarted",J)};
g.wV.prototype.O0=g.rF(42,function(w){return this.app.O0(w)});
g.RX.prototype.O0=g.rF(41,function(w){return g.vhu(this,9,w)});
var Gk=class{constructor(w){this.Y=w}},JX=class extends Gk{get entityMetadata(){return this.Y.entityMetadata}set entityMetadata(w){this.Y.entityMetadata=w}},I5J=class extends Gk{W(){const w=[];this.Y.video&&w.push(this.Y.video);return[...(new Set(w))]}},oxR=class extends Gk{W(){const w=[];this.Y.video&&w.push(this.Y.video);this.Y.playlist&&w.push(this.Y.playlist);this.Y.videoItem&&w.push(this.Y.videoItem);this.Y.playlistItem&&w.push(this.Y.playlistItem);return[...(new Set(w))]}},$6R=class extends Gk{W(){const w=
[];this.Y.localImageEntities&&w.push(...this.Y.localImageEntities);this.Y.videoDownloadContextEntity&&w.push(this.Y.videoDownloadContextEntity);return[...(new Set(w))]}},m6l=class extends Gk{W(){const w=[];this.Y.recommendedVideoMetadata&&w.push(...(new $6R(this.Y.recommendedVideoMetadata)).W());return[...(new Set(w))]}},Axo=class extends Gk{W(){const w=[];this.Y.playbackPosition&&w.push(this.Y.playbackPosition);return[...(new Set(w))]}},FJl=class extends Gk{W(){const w=[];this.Y.creatorEntity&&w.push(this.Y.creatorEntity);
return[...(new Set(w))]}},sfJ=["browse","music/browse","streaming_browse","unplugged/browse"],$00=["offline/playlist_sync_check"],Gm3=["offline"],B3r=["offline/offline_video_playback_position_sync"],Ibk=["offline/get_playback_data_entity"],Sj,f8=class{constructor(w){this.token=w}static async getInstance(){return new Promise(w=>{g.mK().then(Q=>{Q?(f8.instance||(f8.instance=new f8(Q)),w(f8.instance)):w(void 0)})})}async get(w){if(w=await (await XZ(this.token)).get("prefs",w)){var Q=(0,g.l)();
return w.expirationTimestampMs<=Q?void 0:w.value}}async set(w,Q,G=31536E3){const J=(0,g.l)();w={key:w,value:Q,expirationTimestampMs:J+G*1E3};Q=await XZ(this.token);await g.Qz(Q,"prefs",w)}async remove(w){await (await XZ(this.token)).delete("prefs",w)}},S_2={INVALID_ENCODER_VERSION:"Invalid encoder version",KEY_CREATION_FAILED:"Failed to create encoder key",UNKNOWN_DECODE_ERROR:"Failed to decode PES data",UNKNOWN_ENCODE_ERROR:"Failed to encode PES data",WRONG_DATA_TYPE:"Encoder cannot process the data type"},
bE=class extends g.Gu{constructor(w,Q={}){super(S_2[w],{name:"PESEncoderError",type:w,...Q});this.type=w;this.level="WARNING";Object.setPrototypeOf(this,bE.prototype)}},X7j=class{},bcj=class extends X7j{constructor(w){super();this.Y=w}A(w,Q){Q=x3(Q);w=(new TextEncoder).encode(JSON.stringify(w));return this.Y.encrypt(w,Q)}W(w,Q){if(!(w instanceof Uint8Array))throw new bE("WRONG_DATA_TYPE",{sY:1});const G=new TextDecoder;Q=x3(Q);w=this.Y.decrypt(w,Q);return JSON.parse(G.decode(w))}},jDJ={accountLinkStatusEntity:class extends JX{W(){return[]}},
booleanEntity:class extends JX{W(){return[]}},buttonEntity:class extends JX{W(){return[]}},captionTrack:class extends JX{W(){return[]}},channelHandle:class extends JX{W(){return[]}},chipEntity:class extends JX{W(){return[]}},commerceAcquisitionClientPayloadEntity:class extends JX{W(){return[]}},commerceCartListEntity:class extends JX{W(){return[]}},compositeSourceEntity:class extends JX{W(){return[]}},multiviewStagingEntity:class extends JX{W(){const w=[];this.Y.compositeSourceKeys&&w.push(...this.Y.compositeSourceKeys);
return[...(new Set(w))]}},contextNoteFeedEntityPayload:class extends JX{W(){return[]}},contextNoteUserRatingEntityPayload:class extends JX{W(){return[]}},continuationTokenEntity:class extends JX{W(){return[]}},downloadQualityPickerEntity:class extends JX{W(){return[]}},downloadsPageRefreshTokenEntity:class extends JX{W(){return[]}},downloadsPageViewConfigurationEntity:class extends JX{W(){return[]}},downloadStatusEntity:class extends JX{W(){return[]}},dismissState:class extends JX{W(){return[]}},
sfvAudioItemCurrentlyPlayingEntity:class extends JX{W(){return[]}},emojiFountainDataEntity:class extends JX{W(){return[]}},emojiCustomizationSetEntity:class extends JX{W(){return[]}},fakeChannel:class extends JX{W(){const w=[];this.Y.alternateChannel&&w.push(this.Y.alternateChannel);this.Y.alternateChannelList&&w.push(...this.Y.alternateChannelList);this.Y.oneofChannelEntity&&w.push(this.Y.oneofChannelEntity);return[...(new Set(w))]}},fakePlaylist:class extends JX{W(){const w=[];this.Y.entryCollection&&
w.push(this.Y.entryCollection);return[...(new Set(w))]}},fakePlaylistEntryCollection:class extends JX{W(){const w=[];this.Y.parentPlaylist&&w.push(this.Y.parentPlaylist);if(this.Y.entries)for(const Q of this.Y.entries)w.push(...(new I5J(Q)).W());return[...(new Set(w))]}},fakeVideo:class extends JX{W(){const w=[];this.Y.descriptionEntity&&w.push(this.Y.descriptionEntity);this.Y.creators&&w.push(...this.Y.creators);this.Y.theBiggestFan&&w.push(this.Y.theBiggestFan);return[...(new Set(w))]}},fakeVideoDescription:class extends JX{W(){return[]}},
featuredProductsEntity:class extends JX{W(){return[]}},flowStateEntity:class extends JX{W(){return[]}},iconBadgeEntity:class extends JX{W(){return[]}},interstitialInteractionStateEntity:class extends JX{W(){return[]}},likeButtonAnimationEntity:class extends JX{W(){return[]}},liveChatPollStateEntity:class extends JX{W(){return[]}},dataFreshnessEntity:class extends JX{W(){return[]}},liveViewerLeaderboardChatEntryPointStateEntity:class extends JX{W(){return[]}},liveViewerLeaderboardPointsEntity:class extends JX{W(){return[]}},
liveReactionsDataEntity:class extends JX{W(){return[]}},logoEntity:class extends JX{W(){return[]}},macroMarkerEntity:class extends JX{W(){return[]}},mainDownloadsLibraryEntity:class extends JX{W(){const w=[];this.Y.downloadsList&&w.push(this.Y.downloadsList);this.Y.smartDownloadsList&&w.push(this.Y.smartDownloadsList);this.Y.recommendedDownloadsList&&w.push(this.Y.recommendedDownloadsList);this.Y.refresh&&w.push(this.Y.refresh);return[...(new Set(w))]}},mainDownloadsListEntity:class extends JX{W(){const w=
[];this.Y.refresh&&w.push(this.Y.refresh);if(this.Y.downloads)for(const Q of this.Y.downloads)w.push(...(new oxR(Q)).W());return[...(new Set(w))]}},mainPlaylistDownloadStateEntity:class extends JX{W(){const w=[];this.Y.localImageEntities&&w.push(...this.Y.localImageEntities);return[...(new Set(w))]}},mainPlaylistEntity:class extends JX{W(){const w=[];this.Y.channelOwner&&w.push(this.Y.channelOwner);this.Y.videos&&w.push(...this.Y.videos);this.Y.collaboratorChannels&&w.push(...this.Y.collaboratorChannels);
this.Y.downloadState&&w.push(this.Y.downloadState);this.Y.refresh&&w.push(this.Y.refresh);return[...(new Set(w))]}},mainPlaylistVideoEntity:class extends JX{W(){const w=[];this.Y.video&&w.push(this.Y.video);this.Y.channelContributor&&w.push(this.Y.channelContributor);return[...(new Set(w))]}},mainVideoDownloadStateEntity:class extends JX{W(){const w=[];this.Y.playbackData&&w.push(this.Y.playbackData);this.Y.localImageEntities&&w.push(...this.Y.localImageEntities);this.Y.videoDownloadContextEntity&&
w.push(this.Y.videoDownloadContextEntity);return[...(new Set(w))]}},mainVideoEntity:class extends JX{W(){const w=[];this.Y.owner&&w.push(this.Y.owner);this.Y.downloadState&&w.push(this.Y.downloadState);this.Y.userState&&w.push(...(new Axo(this.Y.userState)).W());this.Y.additionalMetadata&&w.push(...(new m6l(this.Y.additionalMetadata)).W());return[...(new Set(w))]}},markersEngagementPanelSyncEntity:class extends JX{W(){return[]}},markersVisibilityOverrideEntity:class extends JX{W(){return[]}},musicAlbumReleaseDetail:class extends JX{W(){const w=
[];this.Y.albumRelease&&w.push(this.Y.albumRelease);this.Y.tracks&&w.push(...this.Y.tracks);return[...(new Set(w))]}},musicAlbumReleaseDownloadMetadataEntity:class extends JX{W(){const w=[];this.Y.trackDownloadMetadatas&&w.push(...this.Y.trackDownloadMetadatas);return[...(new Set(w))]}},musicAlbumRelease:class extends JX{W(){const w=[];this.Y.musicLibraryStatusEntity&&w.push(this.Y.musicLibraryStatusEntity);this.Y.primaryArtists&&w.push(...this.Y.primaryArtists);this.Y.details&&w.push(this.Y.details);
this.Y.userDetails&&w.push(this.Y.userDetails);this.Y.tracks&&w.push(...this.Y.tracks);this.Y.share&&w.push(this.Y.share);this.Y.downloadMetadata&&w.push(this.Y.downloadMetadata);this.Y.refresh&&w.push(this.Y.refresh);return[...(new Set(w))]}},musicAlbumReleaseUserDetail:class extends JX{W(){const w=[];this.Y.albumRelease&&w.push(this.Y.albumRelease);return[...(new Set(w))]}},musicArtistDetail:class extends JX{W(){const w=[];this.Y.parentArtist&&w.push(this.Y.parentArtist);return[...(new Set(w))]}},
musicArtist:class extends JX{W(){const w=[];this.Y.details&&w.push(this.Y.details);this.Y.userDetails&&w.push(this.Y.userDetails);return[...(new Set(w))]}},musicArtistUserDetail:class extends JX{W(){const w=[];this.Y.parentArtist&&w.push(this.Y.parentArtist);return[...(new Set(w))]}},musicDownloadsLibraryEntity:class extends JX{W(){const w=[];this.Y.downloadedTracks&&w.push(...this.Y.downloadedTracks);this.Y.smartDownloadedTracks&&w.push(...this.Y.smartDownloadedTracks);this.Y.downloadedEpisodes&&
w.push(...this.Y.downloadedEpisodes);this.Y.downloadedAlbumReleases&&w.push(...this.Y.downloadedAlbumReleases);this.Y.smartDownloadedAlbumReleases&&w.push(...this.Y.smartDownloadedAlbumReleases);this.Y.downloadedPlaylists&&w.push(...this.Y.downloadedPlaylists);this.Y.smartDownloadedPlaylists&&w.push(...this.Y.smartDownloadedPlaylists);this.Y.metadataOnlyTracks&&w.push(...this.Y.metadataOnlyTracks);return[...(new Set(w))]}},musicLibraryEdit:class extends JX{W(){return[]}},musicLibraryStatusEntity:class extends JX{W(){return[]}},
musicPlaylist:class extends JX{W(){const w=[];this.Y.tracks&&w.push(...this.Y.tracks);this.Y.refresh&&w.push(this.Y.refresh);this.Y.musicLibraryStatusEntity&&w.push(this.Y.musicLibraryStatusEntity);this.Y.details&&w.push(this.Y.details);this.Y.downloadMetadata&&w.push(this.Y.downloadMetadata);this.Y.sideloadMetadata&&w.push(this.Y.sideloadMetadata);this.Y.userDetails&&w.push(this.Y.userDetails);this.Y.entryCollection&&w.push(this.Y.entryCollection);this.Y.share&&w.push(this.Y.share);this.Y.podcastShowAdditionalMetadata&&
w.push(...(new FJl(this.Y.podcastShowAdditionalMetadata)).W());return[...(new Set(w))]}},musicPlaylistDownloadMetadataEntity:class extends JX{W(){const w=[];this.Y.trackDownloadMetadatas&&w.push(...this.Y.trackDownloadMetadatas);return[...(new Set(w))]}},musicShare:class extends JX{W(){return[]}},musicTrackDetail:class extends JX{W(){const w=[];this.Y.parentTrack&&w.push(this.Y.parentTrack);return[...(new Set(w))]}},musicTrackDownloadMetadataEntity:class extends JX{W(){const w=[];this.Y.playbackData&&
w.push(this.Y.playbackData);this.Y.localImageEntities&&w.push(...this.Y.localImageEntities);this.Y.videoDownloadContextEntity&&w.push(this.Y.videoDownloadContextEntity);return[...(new Set(w))]}},musicTrack:class extends JX{W(){const w=[];this.Y.musicLibraryStatusEntity&&w.push(this.Y.musicLibraryStatusEntity);this.Y.artists&&w.push(...this.Y.artists);this.Y.audioModeVersion&&w.push(this.Y.audioModeVersion);this.Y.videoModeVersion&&w.push(this.Y.videoModeVersion);this.Y.userDetails&&w.push(this.Y.userDetails);
this.Y.details&&w.push(this.Y.details);this.Y.albumRelease&&w.push(this.Y.albumRelease);this.Y.share&&w.push(this.Y.share);this.Y.libraryEdit&&w.push(this.Y.libraryEdit);this.Y.downloadMetadata&&w.push(this.Y.downloadMetadata);this.Y.playbackPosition&&w.push(this.Y.playbackPosition);this.Y.lyrics&&w.push(this.Y.lyrics);return[...(new Set(w))]}},musicTrackUserDetail:class extends JX{W(){const w=[];this.Y.parentTrack&&w.push(this.Y.parentTrack);return[...(new Set(w))]}},offlineOrchestrationActionWrapperEntity:class extends JX{W(){return[]}},
offlineVideoPolicy:class extends JX{W(){return[]}},offlineVideoStreams:class extends JX{W(){return[]}},offlineabilityEntity:class extends JX{W(){return[]}},orchestrationWebSamplingEntity:class extends JX{W(){const w=[];this.Y.fakeChildren&&w.push(...this.Y.fakeChildren);return[...(new Set(w))]}},pageHeaderEntity:class extends JX{W(){return[]}},pdpStateEntity:class extends JX{W(){return[]}},pinnedProductEntity:class extends JX{W(){return[]}},playbackData:class extends JX{W(){const w=[];this.Y.transfer&&
w.push(this.Y.transfer);this.Y.adsPlaybackData&&w.push(...this.Y.adsPlaybackData);this.Y.drmLicense&&w.push(this.Y.drmLicense);this.Y.offlineVideoPolicy&&w.push(this.Y.offlineVideoPolicy);this.Y.videoDownloadContextEntity&&w.push(this.Y.videoDownloadContextEntity);return[...(new Set(w))]}},playerStateEntity:class extends JX{W(){return[]}},quantityIncrementerEntity:class extends JX{W(){return[]}},refresh:class extends JX{W(){return[]}},saveToPlaylistListEntity:class extends JX{W(){return[]}},selectedChipIndexEntityPayload:class extends JX{W(){return[]}},
settingEntity:class extends JX{W(){return[]}},stringEntity:class extends JX{W(){return[]}},suggestedFeedbackChipStateEntity:class extends JX{W(){return[]}},transfer:class extends JX{W(){const w=[];this.Y.offlineVideoStreams&&w.push(...this.Y.offlineVideoStreams);this.Y.captionTrack&&w.push(...this.Y.captionTrack);return[...(new Set(w))]}},trendingOfferEntity:class extends JX{W(){return[]}},videoDownloadContextEntity:class extends JX{W(){return[]}},videoOverviewAsyncDataEntity:class extends JX{W(){return[]}},
videoPlaybackPositionEntity:class extends JX{W(){return[]}},votingEntity:class extends JX{W(){return[]}},ytMainChannelEntity:class extends JX{W(){const w=[];this.Y.userChannelDetails&&w.push(this.Y.userChannelDetails);return[...(new Set(w))]}},youchatPendingResponseEntity:class extends JX{W(){return[]}},ytMainDownloadedVideoEntity:class extends JX{W(){const w=[];this.Y.video&&w.push(this.Y.video);this.Y.playbackData&&w.push(this.Y.playbackData);this.Y.offlineVideoPolicy&&w.push(this.Y.offlineVideoPolicy);
return[...(new Set(w))]}},ytMainVideoEntity:class extends JX{W(){const w=[];this.Y.channelOwner&&w.push(this.Y.channelOwner);this.Y.playbackPosition&&w.push(this.Y.playbackPosition);this.Y.localImageEntities&&w.push(...this.Y.localImageEntities);this.Y.downloadStatus&&w.push(this.Y.downloadStatus);return[...(new Set(w))]}}},Gi4=class{constructor(w,Q){this.Y=w;this.W=Q;this.A={}}},x6l=class extends X7j{A(w){return w}W(w){if(w instanceof Uint8Array)throw new bE("WRONG_DATA_TYPE",{sY:0});return w}},
C4l=class{constructor(){this.Y={};this.Y[0]=new x6l;if(!g.PL("aes_pes_encoder_killswitch")){var w=this.Y;try{const J=g.xW();var Q=x3(J);var G=new bcj(new g.OR(Q),new g.zg(Q))}catch(J){throw w=J instanceof Error?new bE("KEY_CREATION_FAILED",{originalMessage:J.message}):new bE("KEY_CREATION_FAILED"),g.P(w),w;}w[1]=G}}},WoR=class extends g.Ne{constructor(w,Q){super();this.token=w;this.Y=Q;this.observers=[];w=new g.cb.BroadcastChannel(`${"PERSISTENT_ENTITY_STORE_SYNC"}:${g.xW()}`);w.onmessage=this.W.bind(this);
this.channel=w}observe(w){this.observers.push(w);return()=>{const Q=this.observers.indexOf(w);Q>=0&&this.observers.splice(Q,1)}}W(w){Q90(this,w.data)}Ez(){this.channel.close()}},RU,H5r=new g.p("elementsCommand");var Fp=new g.p("entityBatchUpdate");var Rm3=new g.p("downloadStatusEntity");var DTJ=new g.p("mainPlaylistEntityActionMetadata");var ua=new g.p("mainVideoEntityActionMetadata");var QfL=new g.p("musicPlaylistEntityActionMetadata");var QA=new g.p("musicTrackEntityActionMetadata");var Pd2=new g.p("localImageEntityActionMetadata");var YR=new g.p("playbackDataActionMetadata");var fbl=new g.p("transferEntityActionMetadata");var VfO=new g.p("videoPlaybackPositionEntityActionMetadata");var XgR=class{constructor(){this.Y=new Map}},KA;new g.s8;new g.s8;var Z5h=class{constructor(){this.locks=navigator.locks}request(w,Q={},G){return this.locks.request(w,Q,J=>G(J))}};var ej=g.cb.caches,gC,Hi,U6h=class{open(w){return ej.open(Pi(w))}has(w){return ej.has(Pi(w))}delete(w){return ej.delete(Pi(w))}async match(w,Q){var G=await this.keys();for(const J of G)if(G=await (await this.open(J)).match(w,Q))return G}},ytR=class extends U6h{async keys(){const w=[],Q=g.xW("CacheStorage keys");var G=await ej.keys();for(const J of G){G=J.indexOf(":");const {zF:N,datasyncId:C}=G===-1?{zF:J}:{zF:J.substring(0,G),datasyncId:J.substring(G+1)};C===Q&&w.push(N)}return w}};var Vmk=class extends g.Ne{constructor(w){super();this.api=w;this.ze={auZ:()=>this.Y,
YqX:()=>this.W};
typeof g.cb.BroadcastChannel!=="undefined"&&(this.Y=new g.cb.BroadcastChannel(`${"PLAYER_OFFLINE_ERROR_SYNC"}:${g.xW()}`),this.Y.onmessage=this.A.bind(this),this.W=new g.cb.BroadcastChannel(`${"PLAYER_OFFLINE_PAUSE_SYNC"}:${g.xW()}`),this.W.onmessage=this.L.bind(this))}A(w){g.hU(this.api,"onOfflineOperationFailure",w.data)}L(w){this.api.publish("offlinetransferpause",w.data)}Ez(){this.Y?.close();this.W?.close()}};var Zcd=class{constructor(w,Q,G){this.O=w;this.C=Q;this.visibility=G;this.J=this.Z=this.G=this.A=this.Y=!1;this.L=new g.ph(()=>{this.U$()});
this.ze={v0:()=>this.W,
U$:()=>{this.U$()},
A0X:()=>this.L};
this.visibility.subscribe("visibilitystatechange",()=>{this.J0()})}J0(){this.Y&&Tq(this)}U$(){this.W&&this.W.resolve();
this.A=this.Y=!1;this.C()}};var pro=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var sN=class{constructor(w,Q,G,J,N=Q,C,W,t,L,v,B){this.entityType=w;this.actionId=Q;this.action=G;this.parentActionId=J;this.rootActionId=N;this.childActionIds=C;this.prereqActionId=W;this.postreqActionIds=t;this.hasChildActionFailed=v;this.retryScheduleIndex=0;this.Y=B||Date.now();this.retryScheduleIndex=L||0}};var gck="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var ui3="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");var Nt=class{constructor(w){this.Y=w}},qi=class{constructor(w,Q,G,J,N,C){this.status=w;this.Y=Q;this.L=G;this.W=J;this.A=N;this.downloadState=C}};var k9O=class extends Nt{constructor(w,Q,G){super(w);this.Y=w;this.B=Q;this.A=G}W(w){return ia(w)?S0l(this,w):QW(w)?x0h(this,w):Promise.reject(Error(`Unsupported action type: ${w.actionType}`))}};var rxJ=class extends Nt{constructor(w,Q){super(w);this.Y=w;this.B=Q}W(w){return QW(w)?U02(this,w):ct2(w)?ZVO(this,w):Gs(w)?km3(this,w):Promise.reject(Error(`Unsupported action type: ${w.actionType}`))}};var yxR=class{constructor(w,Q){this.api=w;this.Y=Q;this.logger=new g.UB("woffle");this.W=!1;this.ze={Cg:this.Cg}}async L(w){if(w.state.Y(128)){const Q=w.state.K1;w=Q?.errorCode;w=w==="net.connect"&&Q?.wT===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":w?.startsWith("net.")?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";await this.a8(this.player.getVideoData().videoId,w)}}async a8(w,Q){this.W||(this.W=!0,Q==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?cz(this,w,!1,!0):(await zs(this,w),
g.ct(w,4),await this.Y.a8(Q)))}XJ(w){w.status===2?(w.status!==this.A&&(hg(this.Y),g.ct(w.videoId,2)),w.vC&&tqk(this.Y,w.videoId,w.vC)):w.status===4?(zs(this,w.videoId),this.a8(w.videoId,w.T5?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):w.status===1&&vrj(this.Y);this.A=w.status;g.hU(this.api,"localmediachange",{videoId:w.videoId,status:w.status})}async L_(){if(!this.W){this.W=!0;var w=this.player.getVideoData().videoId;await zs(this,w);await this.Y.L_()}}Cg(w){switch(w){case "HD_1080":return"hd1080";
case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}}U(w){return this.api.j().U(w)}};var D6r=class extends Nt{constructor(w,Q){super(w);this.Y=w;this.B=Q}W(w){return ia(w)?Y0o(this,w):QW(w)?nCl(this,w):ct2(w)?q00(this,w):Promise.reject(Error(`Unsupported action type: ${w.actionType}`))}};var a5d=class{constructor(){this.actions=[]}Y(w,Q){let G=w.action.actionMetadata.priority-Q.action.actionMetadata.priority;G===0&&(w.Y<Q.Y?G=-1:w.Y>Q.Y&&(G=1));return G}};var lbj=class extends g.Ne{constructor(w,Q,G,J,N){super();this.W=w;this.YB=Q;this.Mc=G;this.Z=J;this.B=N;this.Y=new a5d;this.G=new g.mS;this.A=new g.ph(()=>{this.retry()});
this.O=NaN;this.J=!1;this.ze={EWL:()=>this.Y,
K0:()=>this.G,
J0T:()=>this.A,
retry:()=>this.retry()};
g.Y(this,this.A);this.C=this.W.observe(this.V.bind(this))}Ez(){this.C&&this.C();super.Ez()}createAction(w,Q){const G=g.GJ(w.entityKey).entityType,J=g.Ut(16);return new sN(G,J,w,Q.actionId,Q.rootActionId)}async V(w){if(!this.iV()){var Q=w.offlineOrchestrationActionWrapperEntity??new Set;w=[];for(var G of Q)({entityId:Q}=g.GJ(G)),OVr(this.Y,Q)||w.push(G);G=await ECr(this,w);await la(this,G)}}async retry(){await wwj(this)}};var Y_d=class{constructor(w){this.Z0=w;this.Y=void 0}async Ys(w,Q=!0){if(this.Y){var G=[],J=g.Qi(this.Y.Y,Q),N=[];for(let C=0;C<J.length;C++)Q=this.Y.G(J[C],"json3"),Q=g.J8(Q,{withCredentials:!0,format:"RAW"},3,500).then(W=>{W={metadata:g.X0(J[C]),trackData:W.xhr.responseText};N.push(W)}).sy(W=>{jj("Caption fetch error",W)}),G.push(Q);
await O7L(G);try{await oco(w,N)}catch(C){jj("Caption DB transaction error",C)}}}};var nxb=class extends g.Ne{constructor(w){super();this.Y=w;this.W=this.Y.observe(this.A.bind(this))}Ez(){this.W&&this.W();super.Ez()}async A(w){var Q=w.transfer??new Set;w=[];for(const G of Q)({entityId:Q}=g.GJ(G)),w.push(Q);w.length!==0&&await GIh(this,w)}};var bF3=class extends g.Ne{constructor(w,Q,G,J){super();this.W=w;this.api=Q;this.Fb=G;this.V=J;this.G=new g.mS;this.L=new g.ph(()=>{this.Y&&this.Y.transferState==="TRANSFER_STATE_TRANSFERRING"&&this.G.E3()&&((this.Y.transferRetryCount||0)<3?cz(this.Z,this.J,!1,!1):zs(this.Z,this.J.videoDetails.videoId),this.a8("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Mc=this.RT=0;this.C=this.O=!1;this.lV=g.el(this.api.j().experiments,"html5_transfer_processing_logs_interval");this.kB=new g.WF(this);this.ze={ip1:()=>this.L,
CZb:()=>this.V,
K0:()=>this.G};
this.YB=this.W.observe(this.nA.bind(this));this.Z=new yxR(Q,this);this.pA=new Y_d(Q);this.PL=new nxb(this.W);this.hU=this.G.listen("publicytnetworkstatus-online",this.XE.bind(this));this.JU=this.G.listen("publicytnetworkstatus-offline",this.Uz.bind(this));this.C=this.api.j().U("html5_less_transfer_processing_logs");g.Y(this,this.kB);this.kB.D(Q,"offlinetransferpause",this.aT);if(g.Jv(this.api.j()))this.A="mainVideoDownloadStateEntity";else if(g.wa(this.api.j())||g.CH(this.api.j()))this.A="musicTrackDownloadMetadataEntity"}Ez(){this.YB&&
this.YB();this.PL.dispose();this.L.dispose();this.hU&&g.Im(this.G.tS,this.hU);this.JU&&g.Im(this.G.tS,this.JU);super.Ez()}async aT(w){const Q=g.J3(w,"transfer");if(this.Y&&Q===this.Y.key)cz(this.Z,this.J,!0),this.L.stop();else{const G=await qf(this.W,{mode:"readwrite",UQ:!0},J=>Zk(J,Q,"transfer").then(N=>{if(N&&N.transferState!=="TRANSFER_STATE_COMPLETE"&&N.transferState!=="TRANSFER_STATE_FAILED")return N.transferState="TRANSFER_STATE_PAUSED_BY_USER",Dk(J,N,"transfer").then(()=>N)}));
if(G){w&&this.A&&await Jg(w,this.A,this.W,"DOWNLOAD_STATE_PAUSED");const J=await Pz(this,w);d33({videoId:w,Xs:G,offlineModeType:J})}}}Uz(){if(this.Y&&this.J){cz(this.Z,this.J,!1);const w=this.Y,Q=w?.key?g.GJ(w.key).entityId:"";Q&&this.A&&(new Promise((G,J)=>{Jg(Q,this.A,this.W,"DOWNLOAD_STATE_PAUSED").catch(N=>{J(N)})})).catch(G=>{jj("Download state setting error",G)})}this.L.stop()}XE(){this.Y?mTh(this,this.Y):Hz(this)}async nA(w){if(this.Y&&(this.Y.transferState!=="TRANSFER_STATE_COMPLETE"&&this.Y.transferState!==
"TRANSFER_STATE_FAILED"&&w.transfer&&w.transfer.has(this.Y.key)&&((this.Y=await zq(this.W,this.Y.key,"transfer"))||await Amk(this)),this.Y))return;
await Hz(this)}async a8(w,Q){if(this.Y){var G=this.Y;const N=G?.key?g.GJ(G.key).entityId:"";a:switch(w){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var J=!1;break a;default:J=!0}J&&FsR(this)?(await K8(this,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),w=await Pz(this,N),uE({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:N,Xs:G,offlineModeType:w}),
N&&this.A&&await Jg(N,this.A,this.W,"DOWNLOAD_STATE_RETRYABLE_FAILURE")):(await SI2(this,w),N&&this.A&&await Jg(N,this.A,this.W,"DOWNLOAD_STATE_FAILED"))}else gZ(this,`onTransferFailure: ${w}`);e4(this);G=Hz(this,!0);Q&&Q(G)}async L_(w){if(this.Y)if(FsR(this)){await K8(this,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH");this.Y||gZ(this,"onMaybeTransferStreamsExpiredRetryAttempting");var Q=this.Y,G=Q?.key?g.GJ(Q.key).entityId:"",J=await Pz(this,G);uE({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},
{videoId:G,Xs:Q,offlineModeType:J});Q=vz();g.eh(Q,YR,{isEnqueuedForExpiredStreamUrlRefetch:!0});J=g.J3(G,"playbackData");G=Mi(new sN("playbackData",G,{actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:J,actionMetadata:Q}));await fA(this.W,G,"offlineOrchestrationActionWrapperEntity")}else await SI2(this,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),this.A&&(G=this.Y,(G=G?.key?g.GJ(G.key).entityId:"")&&await Jg(G,this.A,this.W,"DOWNLOAD_STATE_FAILED"));else gZ(this,"onMaybeTransferStreamsExpired");
e4(this);G=Hz(this,!0);w&&w(G)}},j4={TRANSFER_STATE_TRANSFERRING:1,TRANSFER_STATE_TRANSFER_IN_QUEUE:2};var q_J=class{constructor(w,Q){this.B=w;this.api=Q;this.Z=new g.mS;this.J=new g.s8;this.ze={v0:()=>this.A.ze.v0(),
K0:()=>this.Z,
VLI:()=>this.A,
Mg:()=>this.Mg(),
W_:()=>this.W_(),
Eo:()=>this.Eo(),
Hn:()=>this.Hn(),
Ky:()=>this.Ky(),
AA:G=>this.AA(G)};
this.A=new Zcd(()=>Xwo(this),()=>{this.Eo()},this.api.tK(),this.api.U.bind(this.api));
this.Y=new Vmk(this.api);aWd(this.A)}Mg(){return this.J.promise}W_(){if(this.W&&this.O)return this.J.promise;UTl(this).then(this.J.resolve).catch(this.J.reject);return this.J.promise}G(w){return{playbackData:new k9O(w,this.B,this.Y),transfer:new D6r(w,this.B),videoPlaybackPositionEntity:new rxJ(w,this.B)}}async Hn(){this.W&&await sMJ(this.W)}async Eo(){if(this.W||this.O)await this.Mg(),this.Mc!==void 0&&(g.ly(this.Mc),this.Mc=void 0),this.L!==void 0&&(g.ly(this.L),this.L=void 0),this.W?.dispose(),
this.W=void 0,this.O?.dispose(),this.O=void 0,g.hU(this.api,"onOrchestrationLostLeader"),this.J=new g.s8}isOrchestrationLeader(){return this.A.Y}async PL(){return!1}ye(w){var Q=this.Y;Q.api.publish("offlinetransferpause",w);Q.W?.postMessage(w)}async XE(w){const Q=await On();if(Q){var G=g.J3(w,"transfer");await qf(Q,{mode:"readwrite",UQ:!0},J=>{const N=Zk(J,G,"transfer"),C=Zk(J,g.J3(w,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.eJ.all([N,C]).then(([W,t])=>W&&W.transferState===
"TRANSFER_STATE_PAUSED_BY_USER"?(W.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Dk(J,W,"transfer").then(()=>{uE({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",statusType:"USER_RESUMED"},{videoId:w,Xs:W,offlineModeType:t?.offlineModeType});return g.eJ.resolve(null)})):g.eJ.resolve(null))})}}async YB(w=43200){if(!this.Z.E3())return Vq4();
var Q=await On();if(!Q)return[];const G=Date.now()/1E3;var J=await ci(Q,"offlineVideoPolicy");Q=[];for(const N of J)Number(N.lastUpdatedTimestampSeconds)+w<=G&&(J=g.GJ(N.key).entityId,Q.push(J));return Q.length?EN(this,Q,this.V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"):[]}deleteAll(){return EN(this,["!*$_ALL_ENTITIES_!*$"],this.V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})}async refreshAllStaleEntities(w){return await this.YB(w)}setUpPositionSyncInterval(w){this.L!==
void 0&&(g.ly(this.L),this.L=void 0);const Q=w??864E5;this.L=g.Rl(()=>{this.AA(Q)},Q)}async AA(w){try{const Q=await f8.getInstance();
if(!Q)throw Error("prefStorage is undefined");const G=await Q.get("psi"),J=G?.e0?Number(G.e0)/1E3:0,N=Date.now();J+w<=N&&await EN(this,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")}catch(Q){jj("Offline manager error",Q)}}async Ky(){var w=await On();if(!w)return[];var Q=await ci(w,"transfer");w=[];for(const G of Q)G.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&G.key&&(Q=g.GJ(G.key).entityId,w.push(Q));return kIk(this,w)}async C(){return[]}async JU(){}async RT(){}};var f5r=class extends Nt{constructor(w,Q,G){super(w);this.Y=w;this.B=Q;this.A=G}W(w){return ia(w)?ymb(this,w):QW(w)?a$b(this,w):Gs(w)?YIL(this,w):Promise.reject(Error(`Unsupported action type: ${w.actionType}`))}},Ts=[10];var d6d=class extends Nt{constructor(w,Q,G){super(w);this.Y=w;this.B=Q;this.A=G}W(w){return ia(w)?Rgo(this,w):QW(w)?OFh(this,w):Gs(w)?l$o(this,w):Promise.reject(Error(`Unsupported action type: ${w.actionType}`))}},cm0=[10];var zql=class extends Nt{constructor(w,Q,G){super(w);this.Y=w;this.B=Q;this.A=G}W(w){return QW(w)?grh(this,w):Promise.reject(Error(`Unsupported action type: ${w.actionType}`))}};var cx4=class extends q_J{constructor(){super(...arguments);this.V="mainVideoEntity"}G(w){const Q=super.G(w);Q.mainVideoEntity=new d6d(w,this.B,this.Y);Q.mainPlaylistEntity=new f5r(w,this.B,this.Y);Q.mainDownloadsListEntity=new zql(w,this.B,this.Y);return Q}async refreshAllStaleEntities(w,Q){let G=[];this.B.U("web_player_offline_playlist_auto_refresh")&&(G=await egL(this,w,Q));var J=await f8.getInstance();const N=await J?.get("sdois");J=await J?.get("lmqf");N&&(G=G.concat(await HF2(this,N,J??"SD",
w===0)));return G=G.concat(await super.refreshAllStaleEntities(w,Q))}async PL(w){var Q=await On();if(!Q)return!1;Q=await zq(Q,g.Hx,"mainDownloadsListEntity");if(Q?.downloads?.length){w=g.J3(w,"mainVideoEntity");for(const G of Q.downloads)if(G.videoItem===w)return!0}return!1}async C(){var w=await On();if(!w)return[];var Q=await ci(w,"downloadStatusEntity");w=[];for(const G of Q)G.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&G.key&&(Q=g.GJ(G.key).entityId,w.push(Q));return w.length?EN(this,w,"mainVideoEntity",
"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}}):[]}async RT(){const w=await On();w&&await qf(w,{mode:"readwrite",UQ:!0},Q=>k3(Q,"mainVideoEntity").then(G=>{const J=[];for(const N of G)N.userState?.playbackPosition||(G=g.GJ(N.key).entityId,G={key:g.J3(G,"videoPlaybackPositionEntity"),videoId:G,lastPlaybackPositionSeconds:"0"},J.push(Dk(Q,G,"videoPlaybackPositionEntity")),N.userState={playbackPosition:G.key},J.push(Dk(Q,N,
"mainVideoEntity")));return g.eJ.all(J)}))}async JU(){const w=await On();
if(w){var Q=g.J3("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),G=await qf(w,{mode:"readonly",UQ:!0},M=>g.eJ.all([Zk(M,Q,"mainDownloadsListEntity"),Zk(M,g.Hx,"mainDownloadsListEntity"),k3(M,"mainVideoEntity"),k3(M,"mainPlaylistEntity")])),[J,
N,C,W]=G;G=new Set;if(J?.downloads?.length)for(var t of J.downloads){var L=t.videoItem??t.playlistItem;L&&G.add(L)}if(N?.downloads?.length)for(var v of N.downloads)v.videoItem&&G.add(v.videoItem);t=new Set;v=[];for(var B of W){if(B.videos)for(const M of B.videos)(L=JSON.parse(g.GJ(M).entityId).videoId)&&t.add(L);B.key&&!G.has(B.key)&&v.push(B.key)}for(const M of C)M.key&&!G.has(M.key)&&(B=g.GJ(M.key).entityId,t.has(B)||v.push(M.key));v.length&&await S4(w,v)}}};var RqJ=class extends Nt{constructor(w,Q){super(w);this.Y=w;this.A=Q}W(w){return ia(w)?jMR(this,w):QW(w)?ErO(this,w):Gs(w)?T2d(this,w):Promise.reject(Error(`Unsupported action type: ${w.actionType}`))}},wW=[10];var Oc0=class extends Nt{constructor(w,Q){super(w);this.Y=w;this.A=Q}W(w){return ia(w)?w7d(this,w):QW(w)?icd(this,w):Gs(w)?Qgb(this,w):Promise.reject(Error(`Unsupported action type: ${w.actionType}`))}},iw=[10];var l5o=class extends Nt{constructor(w,Q){super(w);this.Y=w;this.A=Q}W(w){return ia(w)?WJj(this,w):QW(w)?tm4(this,w):Gs(w)?LJ4(this,w):Promise.reject(Error(`Unsupported action type: ${w.actionType}`))}},C2L=[10];var KJr=class extends q_J{constructor(){super(...arguments);this.V="musicTrack"}G(w){const Q=super.G(w);Q.musicTrack=new l5o(w,this.Y);Q.musicPlaylist=new Oc0(w,this.Y);Q.musicAlbumRelease=new RqJ(w,this.Y);return Q}async refreshAllStaleEntities(w,Q){let G=await sgl(this,w,Q);return G=G.concat(await super.refreshAllStaleEntities(w,Q))}};g.X_("offline",class extends g.xO{constructor(){super(...arguments);this.events=new g.WF(this);this.B=this.player.j();this.ze={B7T:()=>this.Y,
i7:()=>this.i7(),
m1:w=>this.m1(w)}}create(){g.Y(this,this.events);
if(g.Jv(this.B))this.Y=new cx4(this.B,this.player);else if(g.wa(this.B)||g.CH(this.B))this.Y=new KJr(this.B,this.player);this.events.D(this.player,"onPlaybackStartExternal",()=>{this.i7()});
this.events.D(this.player,"videodatachange",()=>{this.i7()});
this.B.U("html5_offline_playback_position_sync")&&this.events.D(this.player,"presentingplayerstatechange",this.m1)}Sr(){return!1}async Vb(w,Q,G,J){return this.Y?EN(this.Y,w,Q,G,J):Promise.reject()}deleteAll(){return this.Y.deleteAll()}YB(w){return this.Y.YB(w)}refreshAllStaleEntities(w){return this.Y.refreshAllStaleEntities(w)}setUpPositionSyncInterval(w){this.Y.setUpPositionSyncInterval(w)}ye(w){this.Y.ye(w)}XE(w){return this.Y.XE(w)}async i7(){const w=this.player.getVideoData();w.hd()&&BN0(w)&&
this.W!==w.clientPlaybackNonce&&await Mmh(this,w)}async m1(w){var Q=this.player.getVideoData();const G=Q.Fu;if(w.CG(2)||w.CG(512))(w=await On())?(Q=Q.videoId,await zq(w,g.J3(Q,"mainVideoEntity"),"mainVideoEntity")&&await this.Vb([Q],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",{videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:Math.floor(G).toString()}})):jj("PES is undefined")}isOrchestrationLeader(){return this.Y.isOrchestrationLeader()}async updateDownloadState(w,
Q){const G=await On();if(G){var {entityType:J,entityId:N}=g.GJ(w);await Jg(N,J,G,Q,!0)}else jj("PES is undefined")}});})(_yt_player);
